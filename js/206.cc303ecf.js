"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[206],{5174:function(e,t,a){a.r(t),a.d(t,{default:function(){return wt}});var l=a(6252),i=a(3577);const s=e=>((0,l.dD)("data-v-2caff9b6"),e=e(),(0,l.Cn)(),e),o={class:"task inner"},r={class:"box"},n=s((()=>(0,l._)("div",{class:"head"},[(0,l._)("span",{class:"active"},"任务列表")],-1))),d={class:"ctrl"},u={class:"status"},c={class:"search"},p=(0,l.Uk)("查询"),m=s((()=>(0,l._)("i",{class:"erp erpjiufuqianbaoicon06"},null,-1))),g=(0,l.Uk)(" 创建任务"),h={class:"tableWrap"},w={class:"table"},k=(0,l.Uk)("查看详情"),v={key:0,class:"pages"},y={class:"total"};function C(e,t,a,s,C,D){const f=(0,l.up)("el-button"),_=(0,l.up)("el-badge"),x=(0,l.up)("el-input"),T=(0,l.up)("el-table-column"),b=(0,l.up)("el-table"),z=(0,l.up)("el-pagination"),B=(0,l.up)("TaskDetail"),U=(0,l.up)("TaskCreate"),N=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",o,[(0,l._)("div",r,[n,(0,l._)("div",d,[(0,l._)("div",u,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(C.status,(e=>((0,l.wg)(),(0,l.j4)(_,{class:"statusItem",value:e.sup>0?e.sup:"",onClick:t=>D.statusClick(e.value),key:e.value},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{type:C.currentStatus==e.value?"primary":"",link:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.title),1)])),_:2},1032,["type"])])),_:2},1032,["value","onClick"])))),128))]),(0,l._)("div",c,[(0,l.Wm)(x,{modelValue:C.searchKey,"onUpdate:modelValue":t[0]||(t[0]=e=>C.searchKey=e),class:"searchInput",placeholder:"关键词搜索：任务内容、检查建议..."},null,8,["modelValue"]),(0,l.Wm)(f,{type:"primary",class:"searchSubmit",onClick:D.getData,loading:C.searchLoading},{default:(0,l.w5)((()=>[p])),_:1},8,["onClick","loading"]),e.$store.state.power.createTaskBtn?((0,l.wg)(),(0,l.j4)(f,{key:0,type:"primary",class:"searchCreateNewTask",onClick:t[1]||(t[1]=e=>C.showCreateBox=!0)},{default:(0,l.w5)((()=>[m,g])),_:1})):(0,l.kq)("",!0)])]),(0,l._)("div",h,[(0,l._)("div",w,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(b,{size:"large",data:C.list,style:{width:"100%"},"max-height":"600px"},{default:(0,l.w5)((()=>[(0,l.Wm)(T,{label:"任务单号",width:"150","show-overflow-tooltip":""},{default:(0,l.w5)((e=>[(0,l.Uk)(" RW"+(0,i.zw)(e.row.id),1)])),_:1}),(0,l.Wm)(T,{label:"所属棚区",width:"300","show-overflow-tooltip":""},{default:(0,l.w5)((e=>[(0,l.Uk)((0,i.zw)(e.row.gardenTitle)+"-"+(0,i.zw)(e.row.growPlantTitle)+"-"+(0,i.zw)(e.row.address),1)])),_:1}),(0,l.Wm)(T,{label:"执行人"},{default:(0,l.w5)((e=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.row.executors,(e=>((0,l.wg)(),(0,l.iD)("p",{key:e.id},(0,i.zw)(e.name),1)))),128))])),_:1}),(0,l.Wm)(T,{prop:"taskContent",label:"任务内容"}),(0,l.Wm)(T,{label:"状态",width:"200"},{default:(0,l.w5)((e=>[(0,l._)("span",{style:(0,i.j5)({color:e.row.color})},(0,i.zw)(e.row.statusText),5)])),_:1}),(0,l.Wm)(T,{label:"操作",width:"200"},{default:(0,l.w5)((t=>[e.$store.state.power.taskDetail?((0,l.wg)(),(0,l.j4)(f,{key:0,link:"",type:"primary",onClick:e=>D.showDetail(t.row.id)},{default:(0,l.w5)((()=>[k])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data"])),[[N,C.loading]]),C.list.length>0?((0,l.wg)(),(0,l.iD)("div",v,[(0,l._)("span",y,"共 "+(0,i.zw)(C.total)+" 条",1),(0,l.Wm)(z,{currentPage:C.currentPage,"onUpdate:currentPage":t[2]||(t[2]=e=>C.currentPage=e),"page-size":C.pageSize,"onUpdate:page-size":t[3]||(t[3]=e=>C.pageSize=e),onCurrentChange:D.getData,background:"",layout:"prev, pager, next, jumper",total:C.total},null,8,["currentPage","page-size","onCurrentChange","total"])])):(0,l.kq)("",!0)])])]),C.showDetailBox?((0,l.wg)(),(0,l.j4)(B,{key:0,id:C.currentId,onOnCloseDetail:D.onCloseDetail},null,8,["id","onOnCloseDetail"])):(0,l.kq)("",!0),C.showCreateBox?((0,l.wg)(),(0,l.j4)(U,{key:1,onOnCloseCreate:D.onCloseCreate},null,8,["onOnCloseCreate"])):(0,l.kq)("",!0)])}var D=a(8090),f=a(7795),_=a(7913),x=a(9536);const T=e=>((0,l.dD)("data-v-628e7cae"),e=e(),(0,l.Cn)(),e),b={class:"taskDetail purchaseDetailBox"},z={class:"taskDetailInner purchaseDetailBoxInner"},B={key:0,class:"statusImg",src:D,alt:""},U={key:1,class:"statusImg",src:f,alt:""},N={key:2,class:"statusImg",src:_,alt:""},V={key:3,class:"statusImg",src:x,alt:""},W={class:"id wrap"},S={class:"create wrap"},j=T((()=>(0,l._)("div",null,"任务创建",-1))),I=T((()=>(0,l._)("div",null,"任务内容",-1))),P={class:"taskContent"},L=T((()=>(0,l._)("p",null,"操作视频：",-1))),q=["src"],$=["src"],O={class:"nz"},Y=T((()=>(0,l._)("div",{class:"title"},"需用农资：",-1))),R={class:"nzlist"},A={style:{position:"relative",top:"5px"}},M={key:0},F={class:"tag"},K=(0,l.Uk)(" 指定执行人："),Z={key:4,class:"todo wrap"},G=T((()=>(0,l._)("div",null,"任务执行",-1))),H={class:"a"},J={key:5,class:"todo wrap"},E=T((()=>(0,l._)("div",null,"任务检查",-1))),Q=T((()=>(0,l._)("div",null,"检查意见：",-1))),X={class:"todoContent"},ee={style:{display:"block"}},te=T((()=>(0,l._)("i",{class:"erp erptianxie",style:{"margin-right":"5px","font-size":"12px"}},null,-1))),ae=(0,l.Uk)(" 填写检查意见"),le={key:7,class:"form wrap"},ie=T((()=>(0,l._)("div",null,"填写检查意见",-1))),se=(0,l.Uk)(" 是否合格： "),oe=(0,l.Uk)("合格"),re=(0,l.Uk)("不合格"),ne=(0,l.Uk)("打回"),de={class:"formTextarea"},ue=T((()=>(0,l._)("p",null,"意见建议：",-1))),ce={key:8,class:"btns"},pe=(0,l.Uk)("取消"),me=(0,l.Uk)("确定"),ge={class:"btns"},he=(0,l.Uk)("删除任务");function we(e,t,a,s,o,r){const n=(0,l.up)("el-button"),d=(0,l.up)("el-radio"),u=(0,l.up)("el-radio-group"),c=(0,l.up)("el-input"),p=(0,l.up)("el-dialog"),m=(0,l.up)("PlantCropsDetailCDialogDetail"),g=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)(p,{"custom-class":"taskDetail purchaseDetailBox","before-close":r.onClose,"append-to-body":"",modelValue:o.showDetailBox,"onUpdate:modelValue":t[7]||(t[7]=e=>o.showDetailBox=e),title:"任务详情",width:"700px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",z,[0==o.detail.status?((0,l.wg)(),(0,l.iD)("img",B)):(0,l.kq)("",!0),1==o.detail.status?((0,l.wg)(),(0,l.iD)("img",U)):(0,l.kq)("",!0),2==o.detail.status?((0,l.wg)(),(0,l.iD)("img",N)):(0,l.kq)("",!0),3==o.detail.status?((0,l.wg)(),(0,l.iD)("img",V)):(0,l.kq)("",!0),(0,l._)("div",W,"任务单号：RW"+(0,i.zw)(o.detail.id),1),(0,l._)("div",S,[j,(0,l._)("div",null,[(0,l._)("p",null,"创建人："+(0,i.zw)(o.detail.createUserName),1),(0,l._)("p",null,"创建时间："+(0,i.zw)(o.detail.createTime),1)]),I,(0,l._)("div",P,[(0,l._)("div",null,[(0,l._)("p",null,"园区："+(0,i.zw)(o.detail.gardenTitle),1),(0,l._)("p",null,"作物："+(0,i.zw)(o.detail.growPlantTitle)+"-"+(0,i.zw)(o.detail.address),1)]),(0,l._)("div",null,[(0,l._)("p",null,"内容："+(0,i.zw)(o.detail.taskContent),1),(0,l._)("div",null,[L,o.detail.reWire&&o.detail.isVideo?((0,l.wg)(),(0,l.iD)("video",{key:0,controls:"",onClick:t[0]||(t[0]=e=>r.view(o.detail.reWire)),src:o.detail.reWire,alt:""},null,8,q)):(0,l.kq)("",!0),o.detail.reWire&&!o.detail.isVideo?((0,l.wg)(),(0,l.iD)("img",{key:1,onClick:t[1]||(t[1]=e=>r.view(o.detail.reWire)),src:o.detail.reWire,alt:""},null,8,$)):(0,l.kq)("",!0)])])]),(0,l._)("div",O,[Y,(0,l._)("div",R,[(0,l._)("div",A,[o.detail.agricultural&&o.detail.agricultural.length<=0?((0,l.wg)(),(0,l.iD)("span",M,"暂无数据")):(0,l.kq)("",!0)]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.detail.agricultural,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"nzitem",key:e.id},[(0,l._)("p",null,[(0,l._)("span",F,(0,i.zw)(e.agriculturalType),1)]),(0,l._)("p",null,(0,i.zw)(e.agricultural),1)])))),128))])]),(0,l._)("div",null,[(0,l._)("p",null,[K,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.detail.executors,(e=>((0,l.wg)(),(0,l.iD)("span",{style:{margin:"0 5px"},key:e.id},(0,i.zw)(e.name),1)))),128))])]),(0,l._)("div",null,"开始时间："+(0,i.zw)(o.detail.startTime),1),(0,l._)("div",null,"截止时间："+(0,i.zw)(o.detail.endTime),1)]),0!=o.detail.status?((0,l.wg)(),(0,l.iD)("div",Z,[G,(0,l._)("div",null,"执行提交时间："+(0,i.zw)(o.detail.farmRecordBo.workTime),1),(0,l._)("div",null,"执行提交人："+(0,i.zw)(o.detail.farmRecordBo.userName),1),(0,l._)("div",{class:"todoContent",onClick:t[2]||(t[2]=(...e)=>r.showDetailClick&&r.showDetailClick(...e))},[(0,l._)("div",null,[(0,l._)("p",H,(0,i.zw)(o.detail.farmRecordBo.title),1),(0,l._)("p",null,(0,i.zw)(o.detail.farmRecordBo.workTime),1)]),(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.detail.farmRecordBo.farmUseBos,(e=>((0,l.wg)(),(0,l.iD)("p",{class:"u",key:e.id},(0,i.zw)(e.agricultural)+"      "+(0,i.zw)(e.agriculturalCount)+" "+(0,i.zw)(e.agriculturalUnit),1)))),128))]),(0,l._)("div",null,[(0,l._)("p",null,(0,i.zw)(o.detail.farmRecordBo.workText||"无备注"),1),(0,l._)("p",null,(0,i.zw)(o.detail.farmRecordBo.userName),1)])])])):(0,l.kq)("",!0),o.detail.status>1&&e.$store.state.power.checkTaskBtn?((0,l.wg)(),(0,l.iD)("div",J,[E,(0,l._)("div",null,"检查结果："+(0,i.zw)([0,0,"合格","不合格","打回"][o.detail.status]),1),Q,(0,l._)("div",X,[(0,l._)("div",ee,(0,i.zw)(o.detail.opinion),1)])])):(0,l.kq)("",!0),o.showTextArea||1!=o.detail.status?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(n,{key:6,onClick:t[3]||(t[3]=e=>o.showTextArea=!0),type:"primary",link:"",style:{"margin-top":"20px"}},{default:(0,l.w5)((()=>[te,ae])),_:1})),o.showTextArea?((0,l.wg)(),(0,l.iD)("div",le,[ie,(0,l._)("div",null,[(0,l._)("div",null,[se,(0,l.Wm)(u,{modelValue:o.isPass,"onUpdate:modelValue":t[4]||(t[4]=e=>o.isPass=e),class:"ml-4"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"2"},{default:(0,l.w5)((()=>[oe])),_:1}),(0,l.Wm)(d,{label:"3"},{default:(0,l.w5)((()=>[re])),_:1}),(0,l.Wm)(d,{label:"4"},{default:(0,l.w5)((()=>[ne])),_:1})])),_:1},8,["modelValue"])])]),(0,l._)("div",de,[ue,(0,l.Wm)(c,{modelValue:o.textarea,"onUpdate:modelValue":t[5]||(t[5]=e=>o.textarea=e),rows:5,type:"textarea",placeholder:"输入检查意见"},null,8,["modelValue"])])])):(0,l.kq)("",!0),o.showTextArea?((0,l.wg)(),(0,l.iD)("div",ce,[(0,l.Wm)(n,{type:"primary",plain:"",onClick:t[6]||(t[6]=e=>o.showTextArea=!1)},{default:(0,l.w5)((()=>[pe])),_:1}),(0,l.Wm)(n,{type:"primary",onClick:r.submitCheck,loading:o.submitting},{default:(0,l.w5)((()=>[me])),_:1},8,["onClick","loading"])])):(0,l.kq)("",!0),(0,l._)("div",ge,[(0,l.Wm)(n,{type:"primary",plain:"",onClick:r.delTask},{default:(0,l.w5)((()=>[he])),_:1},8,["onClick"])])])),[[g,o.detailLoading]])])),_:1},8,["before-close","modelValue"]),o.showDetail?((0,l.wg)(),(0,l.j4)(m,{key:0,title:o.detailTitle,id:o.detailId,onClose:r.closeDetail,onLoad:r.getData},null,8,["title","id","onClose","onLoad"])):(0,l.kq)("",!0)])}var ke=a(5626),ve=a(2335),ye=a(5170),Ce={name:"taskDetail",props:["id"],data(){return{detailLoading:!1,showDetailBox:!0,detail:{farmRecordBo:{farmUseBos:[]}},showTextArea:!1,textarea:"",isPass:"2",submitting:!1,showDetail:!1,detailTitle:"",detailId:""}},components:{PlantCropsDetailCDialogDetail:ke.Z},mounted(){this.getData()},methods:{delTask(){this.ajax.post("/api/v1/adam/task/deleteTask",{taskId:this.detail.id}).then((e=>{this.$message.success("删除成功"),this.onClose(1)}))},showDetailClick(e){this.detailTitle="农事记录详情",this.detailId=this.detail.farmRecordBo.id,this.showDetail=!0},view(e){window.open(e)},closeDetail(){setTimeout((()=>{this.showDetail=!1}),300)},getData(){this.detailLoading=!0,this.ajax.post("/api/v1/adam/task/taskDetail",{taskId:this.id}).then((e=>{this.detailLoading=!1,e.data.isVideo="img"!=ye.Z.file.type(e.data.reWire),e.data.startTime=ve.Z.time("y-m-d h:i:s",e.data.startTime),e.data.endTime=ve.Z.time("y-m-d h:i:s",e.data.endTime),e.data.createTime=ve.Z.time("y-m-d h:i:s",e.data.createTime),e.data.executors=JSON.parse(e.data.executors),e.data.farmRecordBo=e.data.farmRecordBo||{farmUseBos:{}},e.data.farmRecordBo.farmUseBos=e.data.farmRecordBo.farmUseBos||{},e.data.agricultural=e.data.agricultural?JSON.parse(e.data.agricultural):[],e.data.agricultural=e.data.agricultural.map((e=>(e.agriculturalType||e.agricultural||(e.agricultural=e.agriculturalBo.title,e.agriculturalType=e.agriculturalBo.agriculturalCategory),e))),this.detail=e.data}))},onClose(e=null){"function"==typeof e&&(e=null),this.$emit("onCloseDetail",e),this.showDetailBox=!1},submitCheck(){this.submitting=!0,this.ajax.post("/api/v1/adam/task/taskCheck",{checkStatus:this.isPass,taskId:this.id,taskOpinion:this.textarea}).then((e=>{this.submitting=!1,this.$message.success("提交成功"),this.onClose(1)}))}}},De=a(8118);const fe=(0,De.Z)(Ce,[["render",we],["__scopeId","data-v-628e7cae"]]);var _e=fe;const xe=e=>((0,l.dD)("data-v-07b4c958"),e=e(),(0,l.Cn)(),e),Te={class:"taskDetail purchaseDetailBox"},be={class:"taskDetailInner purchaseDetailBoxInner"},ze={class:"item"},Be=xe((()=>(0,l._)("p",{class:"title"},"园区：",-1))),Ue={class:"item"},Ne=xe((()=>(0,l._)("p",{class:"title"},"作物：",-1))),Ve={class:"item"},We=xe((()=>(0,l._)("p",{class:"title"},"具体内容：",-1))),Se={class:"item",style:{"align-items":"flex-start"}},je=xe((()=>(0,l._)("p",{class:"title"},"需用农资：",-1))),Ie={class:"nz"},Pe={class:"nzBox"},Le={class:"tag"},qe=xe((()=>(0,l._)("span",null,null,-1))),$e=["onClick"],Oe=xe((()=>(0,l._)("i",{class:"erp erpicon_tianjia"},null,-1))),Ye=(0,l.Uk)(" 添加农资"),Re=[Oe,Ye],Ae={class:"item"},Me=xe((()=>(0,l._)("p",{class:"title"},"操作指导：",-1))),Fe={class:"upload"},Ke=["src"],Ze=["src"],Ge={key:3,class:"uploadBox"},He={key:1},Je=xe((()=>(0,l._)("i",{class:"erp erpshangchuan"},null,-1))),Ee=[Je],Qe={key:2},Xe={class:"item"},et=xe((()=>(0,l._)("p",{class:"title"},"执行人：",-1))),tt={class:"item"},at=xe((()=>(0,l._)("p",{class:"title"},"开始时间：",-1))),lt={class:"item"},it=xe((()=>(0,l._)("p",{class:"title"},"截止时间：",-1))),st={class:"btns"},ot=(0,l.Uk)("取消"),rt=(0,l.Uk)("确定");function nt(e,t,a,s,o,r){const n=(0,l.up)("el-option"),d=(0,l.up)("el-select"),u=(0,l.up)("el-input"),c=(0,l.up)("el-progress"),p=(0,l.up)("el-date-picker"),m=(0,l.up)("el-button"),g=(0,l.up)("el-dialog"),h=(0,l.up)("PlantCropsDetailBDialogChose"),w=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",Te,[(0,l.Wm)(g,{"custom-class":"taskDetail purchaseDetailBox","before-close":r.onClose,"append-to-body":"",modelValue:o.showDetailBox,"onUpdate:modelValue":t[9]||(t[9]=e=>o.showDetailBox=e),title:"创建任务",width:"700px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",be,[(0,l._)("div",ze,[Be,(0,l.Wm)(d,{modelValue:o.selectedGarden,"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedGarden=e),style:{width:"650px"},class:"m-2",placeholder:"请选择园区"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.gardenList,((e,t)=>((0,l.wg)(),(0,l.j4)(n,{key:t,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l._)("div",Ue,[Ne,(0,l.Wm)(d,{modelValue:o.selectedPlant,"onUpdate:modelValue":t[1]||(t[1]=e=>o.selectedPlant=e),multiple:"",style:{width:"650px"},class:"m-2",placeholder:"请选择作物"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.plantList,((e,t)=>((0,l.wg)(),(0,l.j4)(n,{key:t,label:e.categoryTitle+"-"+e.address,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l._)("div",Ve,[We,(0,l.Wm)(u,{modelValue:o.taskContent,"onUpdate:modelValue":t[2]||(t[2]=e=>o.taskContent=e),style:{width:"650px"},placeholder:"请输入内容"},null,8,["modelValue"])]),(0,l._)("div",Se,[je,(0,l._)("div",Ie,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.farmUseBos,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"nzItem",key:e.id},[(0,l._)("div",Pe,[(0,l._)("span",null,[(0,l._)("span",Le,(0,i.zw)(e.agriculturalType),1)]),qe,(0,l._)("span",null,(0,i.zw)(e.agricultural),1)]),(0,l._)("i",{class:"erp erpshanchu",onClick:e=>r.removeNz(t)},null,8,$e)])))),128)),(0,l._)("div",{class:"nzAdd",onClick:t[3]||(t[3]=(...e)=>r.addNz&&r.addNz(...e))},Re)])]),(0,l._)("div",Ae,[Me,(0,l._)("div",Fe,[o.video&&o.isVideo?((0,l.wg)(),(0,l.iD)("video",{key:0,controls:"",src:o.video,alt:""},null,8,Ke)):(0,l.kq)("",!0),o.video&&!o.isVideo?((0,l.wg)(),(0,l.iD)("img",{key:1,controls:"",src:o.video,alt:""},null,8,Ze)):(0,l.kq)("",!0),o.video?((0,l.wg)(),(0,l.iD)("i",{key:2,class:"erp erpguanbi",onClick:t[4]||(t[4]=e=>o.video="")})):(0,l.kq)("",!0),o.video?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",Ge,[o.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("input",{key:0,onChange:t[5]||(t[5]=(...e)=>r.uploadFile&&r.uploadFile(...e)),ref:"file",type:"file"},null,544)),o.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",He,Ee)),o.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",Qe,"点击上传视频")),o.uploading?((0,l.wg)(),(0,l.j4)(c,{key:3,width:90,type:"circle",percentage:o.percentage},null,8,["percentage"])):(0,l.kq)("",!0)]))])]),(0,l._)("div",Xe,[et,(0,l.Wm)(d,{modelValue:o.selectedUser,"onUpdate:modelValue":t[6]||(t[6]=e=>o.selectedUser=e),multiple:"",style:{width:"650px"},class:"m-2",placeholder:"请选择执行人"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.userlist,((e,t)=>((0,l.wg)(),(0,l.j4)(n,{key:t,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l._)("div",tt,[at,(0,l.Wm)(p,{"value-format":"YYYY-MM-DD",style:{width:"650px"},modelValue:o.startTime,"onUpdate:modelValue":t[7]||(t[7]=e=>o.startTime=e),type:"date",placeholder:"请选择开始时间"},null,8,["modelValue"])]),(0,l._)("div",lt,[it,(0,l.Wm)(p,{style:{width:"650px"},"value-format":"YYYY-MM-DD",modelValue:o.endTime,"onUpdate:modelValue":t[8]||(t[8]=e=>o.endTime=e),type:"date",placeholder:"请选择截止时间"},null,8,["modelValue"])])])),[[w,o.detailLoading]]),(0,l._)("div",st,[(0,l.Wm)(m,{plain:"",onClick:r.onClose},{default:(0,l.w5)((()=>[ot])),_:1},8,["onClick"]),(0,l.Wm)(m,{type:"primary",onClick:r.submit,loading:o.submitting},{default:(0,l.w5)((()=>[rt])),_:1},8,["onClick","loading"])])])),_:1},8,["before-close","modelValue"]),o.showChose?((0,l.wg)(),(0,l.j4)(h,{key:0,onSave:r.save,onChose:r.chose,selected:o.farmUseBos,onClose:r.closeChose,from:"createTask",neednum:"no"},null,8,["onSave","onChose","selected","onClose"])):(0,l.kq)("",!0)])}var dt=a(3483),ut=a(7702),ct={name:"taskDetail",props:["id"],data(){return{detailLoading:!1,showDetailBox:!0,detail:"",showTextArea:!1,textarea:"",isPass:"1",selectedGarden:"",selectedPlant:[],selectedUser:[],gardenList:[],plantList:[],userlist:[],taskContent:"",startTime:"",endTime:"",video:"",isVideo:!1,uploading:!1,percentage:0,searchCropLoading:!1,submitting:!1,showChose:!1,farmUseBos:[],agricultural:[]}},mounted(){let e=this,t=async function(){await e.getGardenList(),await e.getUserlist()};t()},watch:{selectedGarden(){this.plantList=[],this.selectedPlant="",this.ajax.post("/api/v1/adam/task/getPlantsByGarden",{gardenId:this.selectedGarden}).then((e=>{console.log(e.data),this.plantList=e.data}))}},components:{PlantCropsDetailBDialogChose:ut.Z},methods:{closeChose(){setTimeout((()=>{this.showChose=!1}),300)},chose(e){console.log(e);let t=[...this.farmUseBos,...e].map((e=>(e.agriculturalCount=Number(e.agriculturalCount),e)));var a=function(e){for(var t=[],a=[],l=0;l<e.length;l++)a.indexOf(e[l].agricultural)>-1?t[a.indexOf(e[l].agricultural)].agriculturalCount=e[l].agriculturalCount:(a.push(e[l].agricultural),e[l].isUse=1,t.push(e[l]));return t};this.farmUseBos=a(t)},removeNz(e){this.farmUseBos.splice(e,1)},save(e){this.farmUseBos.push(e)},addNz(){this.showChose=!0},getGardenList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/garden/list",{pageNum:1,pageSize:100,param:{}}).then((t=>{this.gardenList=t.data,e()}))}))},getUserlist(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/task/getOrganizationUsers",{pageNum:1,pageSize:100,param:{}}).then((t=>{this.userlist=t.data,e()}))}))},onClose(e=null){"function"==typeof e&&(e=null),this.$emit("onCloseCreate",e),this.showDetailBox=!1},uploadFile(){this.uploading=!0;let e=this.$refs.file.files[0];(0,dt.Z)(e,`erp/park/${e.name}`).then((e=>{e.url&&(this.isVideo="img"!=ye.Z.file.type(e.url),this.video=e.url,this.uploading=!1,this.percentage=0)}))},searchCrop(){},submit(){let e="";if(this.gardenList.map((t=>{t.id==this.selectedGarden&&(e=t.title)})),!this.selectedGarden)return void this.$message.warning("请选择园区");if(0==this.selectedPlant.length)return void this.$message.warning("请选择作物");if(!this.taskContent)return void this.$message.warning("请输入具体内容");if(0==this.selectedUser.length)return void this.$message.warning("请选择执行人");if(!this.startTime)return void this.$message.warning("请选择开始时间");if(!this.endTime)return void this.$message.warning("请选择截止时间");let t=this.selectedUser.map((e=>{let t={id:"",name:""};return this.userlist.map((a=>{e==a.id&&(t.id=a.id,t.name=a.name)})),t}));this.submitting=!0;let a=this.farmUseBos.map((e=>(console.log(isNaN(e.agriculturalCount)),e.agriculturalCount=isNaN(e.agriculturalCount)?0:e.agriculturalCount,{agriculturalBo:{title:e.agricultural,agriculturalCategory:e.agriculturalType,manufacturers:e.manufacturers}})));this.ajax.post("/api/v1/adam/task/createTask",{endTime:this.endTime,executors:JSON.stringify(t),gardenId:this.selectedGarden,gardenTitle:e,growPlants:this.selectedPlant,opinion:"",reWire:this.video,startTime:this.startTime,taskContent:this.taskContent,agricultural:JSON.stringify(a)}).then((e=>{this.submitting=!1,200==e.code&&1==e.data?(this.onClose(1),this.showDetailBox=!1):this.$message.error(e.message)}))}}};const pt=(0,De.Z)(ct,[["render",nt],["__scopeId","data-v-07b4c958"]]);var mt=pt,gt={name:"task",data(){return{status:[{title:"全部",value:"-1",sup:0},{title:"待执行",value:"0",sup:0},{title:"待检查",value:"1",sup:0},{title:"合格",value:"2",sup:0},{title:"不合格",value:"3",sup:0}],loading:!1,currentStatus:"-1",searchKey:"",searchLoading:!1,list:[],currentPage:1,pageSize:10,total:0,showDetailBox:!1,showCreateBox:!1,currentId:""}},components:{TaskDetail:_e,TaskCreate:mt},mounted(){this.getData(),this.getStatus_1()},methods:{statusClick(e){this.currentStatus=e,this.getData()},getStatus_1(){this.ajax.post("/api/v1/adam/task/manageTaskList",{pageNum:this.currentPage,pageSize:10,param:{gardenId:"",growPlantId:"",status:1,keyWord:""}}).then((e=>{this.status[2].sup=e.total}))},getData(){this.loading=!0,this.ajax.post("/api/v1/adam/task/manageTaskList",{pageNum:this.currentPage,pageSize:10,param:{gardenId:-1,growPlantId:-1,status:this.currentStatus,keyWord:this.searchKey}}).then((e=>{this.list=e.data.map((e=>{switch(e.executors=JSON.parse(e.executors),e.status){case 0:e.statusText="待执行",e.color="#A8A8A8";break;case 1:e.statusText="待检查",e.color="#1890FF";break;case 2:e.statusText="合格",e.color="#0DD71C";break;case 3:e.statusText="不合格",e.color="#FF4949";break;case 4:e.statusText="打回",e.color="#FF4949";break}return e})),this.total=e.total,this.loading=!1}))},showDetail(e){this.currentId=e,this.showDetailBox=!0},onCloseDetail(e){1==e&&this.getData();let t=setTimeout((()=>{this.showDetailBox=!1,clearTimeout(t)}),500)},onCloseCreate(e){1==e&&this.getData(),console.log(e);let t=setTimeout((()=>{this.showCreateBox=!1,clearTimeout(t)}),500)}}};const ht=(0,De.Z)(gt,[["render",C],["__scopeId","data-v-2caff9b6"]]);var wt=ht},5170:function(e,t){const a={time(e="y-m-d h:i:s",t=null){let a=this.parse(t);return e=e.replace("y",a.getFullYear()),e=e.replace("m",this.to2(a.getMonth()+1)),e=e.replace("d",this.to2(a.getDate())),e=e.replace("h",this.to2(a.getHours())),e=e.replace("i",this.to2(a.getMinutes())),e=e.replace("s",this.to2(a.getSeconds())),e=e.replace("w",a.getDay()),e},chineseDate(e){let t=e?new Date(e):new Date,a=t.toLocaleString("zh-CN-u-ca-chinese");a=a.replace(/(\d+)\s*?年/,((e,t)=>{let a="";return a="甲乙丙丁戊己庚辛壬癸".charAt((t-4)%10),a+="子丑寅卯辰巳午未申酉戌亥".charAt((t-4)%12),a})),a=a.split(" ")[0];let l=a.substr(0,2)+"年",i=a.substring(2,a.match("月").index)+"月",s=a.match(/\d+/)[0];s=s<11?"初"+r.toChinese(s):r.toChinese(s);let o=["猴","鸡","狗","猪","鼠","牛","虎","兔","龙","蛇","马","羊"],n=t.toLocaleString("zh-CN-u-ca-chinese").substr(0,4)%12,d=o[n];return{g:l,m:i,d:s,a:d}},parse(e=null){return e?new Date(e):new Date},to2(e){return Number(e)<10?"0"+e:e},monthCount(e=null){let t=this.parse(e),a=t.getFullYear(),l=this.to2(t.getMonth()+2),i=this.parse(`${a}-${l}-01`).getTime()/1e3,s=this.parse(1e3*(i-86400));return s.getDate()},nextMonthCount(e=null){let t=this.parse(e),a=t.getFullYear(),l=this.to2(t.getMonth()+3),i=this.parse(`${a}-${l}-01`).getTime()/1e3,s=this.parse(1e3*(i-86400));return s.getDate()},preMonthCount(e=null){let t=this.parse(e),a=t.getFullYear(),l=this.to2(t.getMonth()+1),i=this.parse(`${a}-${l}-01`).getTime()/1e3,s=this.parse(1e3*(i-86400));return s.getDate()},timeRemaining(e,t="d天h小时i分s秒"){let a=this.parse(e).getTime()/1e3-this.parse().getTime()/1e3;return this.unixToString(t,a)},timePast(e,t="d天h小时i分s秒"){let a=this.parse().getTime()/1e3-this.parse(e).getTime()/1e3;return this.unixToString(t,a)},unixToString(e,t){t=parseInt(t);let l=parseInt(t/86400),i=parseInt((t-86400*l)/3600),s=parseInt((t-86400*l-3600*i)/60),o=t-86400*l-3600*i-60*s;return e=e.replace("d",a.to2(l)),e=e.replace("h",a.to2(i)),e=e.replace("i",a.to2(s)),e=e.replace("s",a.to2(o)),e}},l={lastName(e){return"."+e.split(".").pop()},type(e){let t=this.lastName(e).toLowerCase(),a={".mp4":"video",".avi":"video",".wmv":"video",".rmvb":"video",".mov":"video",".m4v":"video",".mkv":"video",".flv":"video",".3gp":"video",".mp3":"audio",".wav":"audio",".midi":"audio",".ape":"audio",".aac":"audio",".wma":"audio",".png":"img",".jpg":"img",".jpeg":"img",".gif":"img",".bmp":"img",".svg":"img",".webp":"img"};return a[t]??"other"},createName(e){return(new Date).getTime()+this.lastName(e).toLowerCase()}},i={copy(e){return JSON.parse(JSON.stringify(e))},find(e,t){let a=t.split("."),l=JSON.parse(JSON.stringify(a));return l.map((t=>{e=e[a[0]],a.shift()})),e}},s={total(e,t={}){let a=[],l=[],i=t.tag||"id",s=t.total||"num",o=e.map((e=>e[i]));if(o=Array.from(new Set(o)),e.map((e=>{let t=l.indexOf(e[i]);t>-1?a[t][s]+=e[s]:(l.push(e[i]),a.push(e))})),t.out){let e=Object.keys(t.out);a=a.map((a=>{let l={};return e.map((e=>{null==t.out[e]?l[e]=a[e]:l[t.out[e]]=a[e]})),l}))}return t.sortBy&&a[0][t.sortBy]?this.objSort(a,t.sortBy,t.orderBy):a},sort(e,t="asc"){let a=[];while(e.length>0){let l="asc"==t?this.min(e):this.max(e);a.push(l.value),e.splice(l.index,1)}return a},objSort(e,t,a="asc"){let l=[],i=this.sort(e.map((e=>e[t])),a);return i.map((a=>{e.map((e=>{a==e[t]&&l.push(e)}))})),l},min(e){let t=i.copy(e)[0],a=0;return e.map(((e,l)=>{e<t&&(t=e,a=l)})),{value:t,index:a}},max(e){let t=i.copy(e)[0],a=0;return e.map(((e,l)=>{e>t&&(t=e,a=l)})),{value:t,index:a}}},o={isIdcard(e){let t=new RegExp(/^[1-9]\d{5}(19|20)\d{2}((0[1-9]|1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/);return t.test(e)},isPhone(e){let t=new RegExp(/^1(3|5|6|7|8|9)\d{9}$/);return t.test(e)},isMail(e){let t=new RegExp(/^([0-9a-zA-Z]|-|_)+@[0-9a-z]+.[a-z]+$/);return t.test(e)},encodeUnicode(e){let t=[];for(let a=0;a<e.length;a++)t[a]=("00"+e.charCodeAt(a).toString(16)).slice(-4);return"\\u"+t.join("\\u")},decodeUnicode(e){return e=e.replace(/\\/g,"%"),decodeURI(e)}},r={money(e){},toChinese(e){if(e=String(e),e.match(/\D/)||e.length>=14)return;let t=["零","一","二","三","四","五","六","七","八","九","十"],a=["","十","百","千","万","十","百","千","亿","十","百","千","万"],l=String(e).split("").reverse().map(((e,l)=>(e=0==Number(e)?t[Number(e)]:t[Number(e)]+a[l],e))).reverse().join("");return l=l.replace(/^一十/,"十"),l=l.replace(/零+/,"零"),l=l.replace(/零$/,""),l}},n={toObject(e){const t=e=>{let t={},a=!0;return Array.from(e.attributes).map((e=>{t[e.nodeName]=e.nodeValue,a=!1})),a?null:t},a=e=>{let a=[];const l=(e,a)=>{let i={typeName:this.nodeTypes(e.nodeType),nodeType:e.nodeType};if(3==i.nodeType&&e.nodeValue.match(/\S/)&&(i["content"]=e.nodeValue,i["tag"]=e.nodeName,a.push(i)),1==i.nodeType){let s=t(e);if(s&&(i["attributes"]=s),e.childNodes.length<=1&&(i["content"]=e.innerHTML,i["tag"]=e.nodeName.toLowerCase()),e.childNodes.length>1){i["children"]=[],i["tag"]=e.nodeName.toLowerCase();for(let t=0;t<e.childNodes.length;t++)l(e.childNodes[t],i.children)}a.push(i)}};return l(e,a),a[0].children};return a(e)},nodeTypes(e){const t=["","元素节点","属性节点","文本节点","字符数据节点(文本不会被解析器解析)","实体引用节点","实体节点","处理指令节点","注释节点","文档节点 (DOM树的根节点)","向为文档定义的实体提供接口","表示邻接节点和它们的子树","代表一个符号在DTD中的声明"];return e?t[e]:t}},d={device(){let e=navigator.userAgent.toLowerCase(),t=null;return t=e.match("android")?101:e.match("iphone")?102:e.match("ipad")||e.match("macintosh")?103:e.match("intel mac")?203:e.match("msie")?202:201,t},system(){let e=navigator.userAgent.toLowerCase(),t=null;return t=e.match("windows nt 5")?5:e.match("windows nt 6.1")?7:e.match("windows nt 6.2")?8:e.match("windows nt 6.3")?81:e.match("windows nt 10")?10:e.match("intel mac")?100:e.match("x11")?200:300,t}},u={};t["Z"]={object:i,array:s,string:o,number:r,dom:n,agent:d,timer:a,file:l,ajax:u}},8090:function(e,t,a){e.exports=a.p+"img/0.b107b999.png"},7795:function(e,t,a){e.exports=a.p+"img/1.a4a41189.png"},7913:function(e,t,a){e.exports=a.p+"img/2.16b2581e.png"},9536:function(e,t,a){e.exports=a.p+"img/3.6bfbb5bf.png"}}]);
//# sourceMappingURL=206.cc303ecf.js.map