"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[270],{6270:function(e,t,a){a.r(t),a.d(t,{default:function(){return ke}});var l=a(6252),i=a(3577);const s={class:"stockList"},o={class:"ctrl"},u={class:"search"},n=(0,l.Uk)("查询"),r={class:"buttons"},d=(0,l.Uk)("批量入库"),c=(0,l.Uk)("登记新农资"),m=(0,l.Uk)("出入库记录"),p={class:"tableWrap"},g={class:"table"},h=(0,l.Uk)("明细"),w=(0,l.Uk)("入库"),f=(0,l.Uk)("出库"),y={key:0,class:"pages"},k={class:"total"};function _(e,t){const a=(0,l.up)("el-input"),_=(0,l.up)("el-button"),v=(0,l.up)("el-option"),b=(0,l.up)("el-select"),B=(0,l.up)("el-table-column"),C=(0,l.up)("el-table"),x=(0,l.up)("el-pagination"),D=(0,l.up)("StockDetail"),V=(0,l.up)("StockReg"),W=(0,l.up)("StockPutBatch"),U=(0,l.Q2)("loading");return(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",s,[(0,l._)("div",o,[(0,l._)("div",u,[(0,l.Wm)(a,{modelValue:e.searchKey,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchKey=t),class:"searchInput",placeholder:"关键词搜索：农资类型、农资名称、厂家名称"},null,8,["modelValue"]),(0,l.Wm)(_,{type:"primary",class:"searchSubmit",onClick:e.getData},{default:(0,l.w5)((()=>[n])),_:1},8,["onClick"]),(0,l.Wm)(b,{modelValue:e.defaultClassify,"onUpdate:modelValue":t[1]||(t[1]=t=>e.defaultClassify=t),class:"searchSelect",onChange:e.selectByClassify,placeholder:"全部分类"},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{label:"全部分类",value:"0"}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.classifyList,((e,t)=>((0,l.wg)(),(0,l.j4)(v,{key:t,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),(0,l.Wm)(b,{modelValue:e.defaultStatus,"onUpdate:modelValue":t[2]||(t[2]=t=>e.defaultStatus=t),class:"searchSelect",onChange:e.selectByStatus,placeholder:"全部显示"},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{label:"全部显示",value:"-1"}),(0,l.Wm)(v,{label:"无库存",value:"1"}),(0,l.Wm)(v,{label:"有库存",value:"2"})])),_:1},8,["modelValue","onChange"])]),(0,l._)("div",r,[e.$store.state.power.batchMaterialsIntoBtn?((0,l.wg)(),(0,l.j4)(_,{key:0,type:"primary",onClick:t[3]||(t[3]=t=>e.showBatch=!0)},{default:(0,l.w5)((()=>[d])),_:1})):(0,l.kq)("",!0),e.$store.state.power.addMaterialsInfoBtn?((0,l.wg)(),(0,l.j4)(_,{key:1,type:"success",onClick:t[4]||(t[4]=t=>e.showReg=!0)},{default:(0,l.w5)((()=>[c])),_:1})):(0,l.kq)("",!0),e.$store.state.power.stockRecordBtn?((0,l.wg)(),(0,l.j4)(_,{key:2,type:"warning",onClick:e.gotoRecord},{default:(0,l.w5)((()=>[m])),_:1},8,["onClick"])):(0,l.kq)("",!0)])]),(0,l._)("div",p,[(0,l._)("div",g,[(0,l.Wm)(C,{size:"large",data:e.list,style:{width:"100%"},"max-height":"600px"},{default:(0,l.w5)((()=>[(0,l.Wm)(B,{prop:"agriculturalBo.title",label:"农资名称","show-overflow-tooltip":""}),(0,l.Wm)(B,{prop:"agriculturalBo.agriculturalCategory",label:"类型"}),(0,l.Wm)(B,{prop:"agriculturalBo.manufacturers",label:"生产厂家","show-overflow-tooltip":""}),(0,l.Wm)(B,{prop:"orderStatus",label:"规格"},{default:(0,l.w5)((e=>[(0,l.Uk)((0,i.zw)(e.row.agriculturalBo.agriculturalCount)+(0,i.zw)(e.row.agriculturalBo.unitweight)+"/"+(0,i.zw)(e.row.agriculturalBo.unitmeasurement),1)])),_:1}),(0,l.Wm)(B,{label:"库存"},{default:(0,l.w5)((e=>[(0,l._)("span",{style:(0,i.j5)({color:e.row.agriculturalCount>0?"#606266":"red"})},(0,i.zw)(e.row.agriculturalUnit)+(0,i.zw)(e.row.agriculturalBo.unitmeasurement)+"（共"+(0,i.zw)(e.row.agriculturalCount)+(0,i.zw)(e.row.agriculturalBo.unitweight)+"） ",5)])),_:1}),(0,l.Wm)(B,{label:"操作",width:"260"},{default:(0,l.w5)((t=>[e.$store.state.power.materialsStockDetail?((0,l.wg)(),(0,l.j4)(_,{key:0,link:"",type:"primary",onClick:a=>e.viewDetail(t.row.id)},{default:(0,l.w5)((()=>[h])),_:2},1032,["onClick"])):(0,l.kq)("",!0),e.$store.state.power.materialsInto?((0,l.wg)(),(0,l.j4)(_,{key:1,link:"",type:"primary",onClick:a=>e.stock(!0,t.row.id)},{default:(0,l.w5)((()=>[w])),_:2},1032,["onClick"])):(0,l.kq)("",!0),e.$store.state.power.materialsOut?((0,l.wg)(),(0,l.j4)(_,{key:2,link:"",type:"primary",onClick:a=>e.stock(!1,t.row.id)},{default:(0,l.w5)((()=>[f])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data"]),e.list.length>0?((0,l.wg)(),(0,l.iD)("div",y,[(0,l._)("span",k,"共 "+(0,i.zw)(e.total)+" 条",1),(0,l.Wm)(x,{currentPage:e.currentPage,"onUpdate:currentPage":t[5]||(t[5]=t=>e.currentPage=t),"page-size":e.pageSize,"onUpdate:page-size":t[6]||(t[6]=t=>e.pageSize=t),background:"",onCurrentChange:e.getData,layout:"prev, pager, next, jumper",total:e.total},null,8,["currentPage","page-size","onCurrentChange","total"])])):(0,l.kq)("",!0)])]),e.showDetailBox?((0,l.wg)(),(0,l.j4)(D,{key:0,id:e.currentDetailId,onCloseDetailBox:e.closeDetailBox},null,8,["id","onCloseDetailBox"])):(0,l.kq)("",!0),e.showReg?((0,l.wg)(),(0,l.j4)(V,{key:1,needSubmit:"",onOnSave:e.onRegSave,onCloseReg:e.closeReg},null,8,["onOnSave","onCloseReg"])):(0,l.kq)("",!0),e.showBatch?((0,l.wg)(),(0,l.j4)(W,{key:2,onLoad:e.getData,onCloseBathBox:e.closeBathBox},null,8,["onLoad","onCloseBathBox"])):(0,l.kq)("",!0)])),[[U,e.loading]])}const v={class:"stockDetail"},b={class:"stockDetailBoxInner"},B={class:"head"};function C(e,t){const a=(0,l.up)("el-dialog"),s=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",v,[(0,l.Wm)(a,{"custom-class":"stockDetailBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showDetailBox,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showDetailBox=t),title:"库存明细",width:"600px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",b,[(0,l._)("div",B,[(0,l._)("p",null,(0,i.zw)(e.detail.agriculturalBo.title),1),(0,l._)("p",null,(0,i.zw)(e.detail.agriculturalUnit)+"袋 (共"+(0,i.zw)(e.detail.agriculturalCount)+"公斤)",1),(0,l._)("p",null,[(0,l._)("span",null,(0,i.zw)(e.detail.agriculturalBo.agriculturalCategory),1)]),(0,l._)("p",null,(0,i.zw)(e.detail.agriculturalBo.manufacturers),1),(0,l._)("p",null," ("+(0,i.zw)(e.detail.agriculturalBo.agriculturalCount)+(0,i.zw)(e.detail.agriculturalBo.unitweight)+"/"+(0,i.zw)(e.detail.agriculturalBo.unitmeasurement)+") ",1)]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.list,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"card",key:t},[(0,l._)("div",null,[(0,l._)("p",null,(0,i.zw)(e.workTypeName),1),(0,l._)("p",null,(0,i.zw)(e.outInTime),1)]),(0,l._)("div",null,[(0,l._)("p",{class:(0,i.C_)(0==e.type?"add":"miuns")},(0,i.zw)(0==e.type?"+":"-")+(0,i.zw)(e.agriculturalCount)+(0,i.zw)(e.agriculturalBo.unitweight),3),(0,l._)("p",null,(0,i.zw)(e.username),1)])])))),128))])),[[s,e.loading]])])),_:1},8,["before-close","modelValue"])])}var x={props:["id"],name:"stockDetail",data(){return{loading:!1,detail:{agriculturalBo:{}},list:[],showDetailBox:!0}},mounted(){let e=this;const t=async function(){e.loading=!0,await e.getDetail(),await e.getList(),e.loading=!1};t()},methods:{getDetail(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/agricultural-detail",{id:this.id}).then((t=>{this.detail=t.data,e()}))}))},getList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/inventoryDetail-list",{pageNum:1,pageSize:10,param:{id:this.id}}).then((t=>{this.list=t.data,e()}))}))},onClose(){this.$emit("closeDetailBox",0),this.showDetailBox=!1}}},D=a(8118);const V=(0,D.Z)(x,[["render",C],["__scopeId","data-v-6a8efcba"]]);var W=V,U=a(6799),S=a(9963);const z=e=>((0,l.dD)("data-v-49d4fb4c"),e=e(),(0,l.Cn)(),e),L={class:"StockPutBatch"},T={class:"StockPutBatchInner"},I={class:"content"},$={class:"info"},R={class:"tag"},j={class:"info"},P={style:{color:"#409eff"}},q=z((()=>(0,l._)("span",null,"入库数量：",-1))),N=z((()=>(0,l._)("p",null,null,-1))),K={class:"item"},H=z((()=>(0,l._)("i",{style:{"font-size":"12px","margin-right":"5px"},class:"erp erpicon_tianjia"},null,-1))),O=(0,l.Uk)(" 添加 "),Y={class:"item log"},Z=z((()=>(0,l._)("span",{class:"must"},"*",-1))),M=(0,l.Uk)(" 入库类型： "),A=z((()=>(0,l._)("span",{class:"must"},"*",-1))),F=(0,l.Uk)(" 入库时间： "),Q=z((()=>(0,l._)("span",{class:"must"},"*",-1))),J=(0,l.Uk)(" 退回人： "),E={class:"item"},G=z((()=>(0,l._)("p",{class:"title"},[(0,l._)("span",{class:"must"},"*"),(0,l.Uk)(" 单据、凭证、照片：")],-1))),X={class:"pics"},ee=["src"],te=["onClick"],ae={key:0,class:"upload"},le={key:1},ie=z((()=>(0,l._)("i",{class:"erp erpshangchuan"},null,-1))),se=[ie],oe={key:2},ue={class:"item"},ne=z((()=>(0,l._)("p",{class:"title"},"备注：",-1))),re={class:"item"},de=(0,l.Uk)("提交");function ce(e,t,a,s,o,u){const n=(0,l.up)("el-input"),r=(0,l.up)("el-button"),d=(0,l.up)("el-option"),c=(0,l.up)("el-select"),m=(0,l.up)("el-date-picker"),p=(0,l.up)("el-progress"),g=(0,l.up)("StockReg"),h=(0,l.up)("el-dialog"),w=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",L,[(0,l.Wm)(h,{"custom-class":"StockPutBatch","before-close":u.onClose,"append-to-body":"",modelValue:o.showBatchBox,"onUpdate:modelValue":t[5]||(t[5]=e=>o.showBatchBox=e),title:"批量入库",width:"700px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",T,[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",I,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.list,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"item",key:t},[(0,l._)("div",$,[(0,l._)("p",null,[(0,l._)("span",null,(0,i.zw)(e.agriculturalBo.title),1),(0,l._)("span",R,(0,i.zw)(e.agriculturalBo.agriculturalCategory),1)]),(0,l._)("p",null,(0,i.zw)(e.agriculturalBo.manufacturers),1),(0,l._)("p",null," 规格："+(0,i.zw)(e.agriculturalBo.agriculturalCount)+(0,i.zw)(e.agriculturalBo.unitweight)+"/"+(0,i.zw)(e.agriculturalBo.unitmeasurement),1)]),(0,l._)("div",j,[(0,l._)("p",P," 库存："+(0,i.zw)(e.agriculturalUnit)+(0,i.zw)(e.agriculturalBo.unitmeasurement)+" (共"+(0,i.zw)(e.agriculturalCount)+(0,i.zw)(e.agriculturalBo.unitweight)+") ",1),(0,l._)("p",null,[q,(0,l.Wm)(n,{size:"small",style:{width:"70px","margin-right":"10px"},modelValue:e.num,"onUpdate:modelValue":t=>e.num=t},null,8,["modelValue","onUpdate:modelValue"]),(0,l._)("span",null,(0,i.zw)(e.agriculturalBo.unitweight),1)]),N])])))),128)),(0,l._)("div",K,[(0,l.Wm)(r,{size:"small",type:"primary",onClick:u.add},{default:(0,l.w5)((()=>[H,O])),_:1},8,["onClick"])]),(0,l._)("div",Y,[(0,l._)("p",null,[Z,M,(0,l.Wm)(c,{modelValue:o.defaultType,"onUpdate:modelValue":t[0]||(t[0]=e=>o.defaultType=e),class:"m-2",style:{width:"570px"},placeholder:"请选择入库类型"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.typeList,(e=>((0,l.wg)(),(0,l.j4)(d,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,l._)("p",null,[A,F,(0,l.Wm)(m,{modelValue:o.outInTime,"onUpdate:modelValue":t[1]||(t[1]=e=>o.outInTime=e),style:{width:"570px"},type:"datetime",placeholder:"请选择时间"},null,8,["modelValue"])]),(0,l.wy)((0,l._)("p",null,[Q,J,(0,l.Wm)(c,{modelValue:o.userName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.userName=e),class:"m-2",style:{width:"570px","margin-left":"14px"},placeholder:"请选择退回人"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.userlist,(e=>((0,l.wg)(),(0,l.j4)(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])],512),[[S.F8,o.defaultType==o.backUser]])]),(0,l._)("div",E,[G,(0,l._)("div",X,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.imgs,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"img",key:t},[(0,l._)("img",{src:e,alt:""},null,8,ee),(0,l._)("i",{class:"erp erpguanbi",onClick:e=>u.removeImg(t)},null,8,te)])))),128)),o.imgs.length<2?((0,l.wg)(),(0,l.iD)("div",ae,[o.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("input",{key:0,onChange:t[3]||(t[3]=(...e)=>u.uploadFile&&u.uploadFile(...e)),ref:"file",type:"file"},null,544)),o.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",le,se)),o.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",oe,"点击上传单据、凭证、照片")),o.uploading?((0,l.wg)(),(0,l.j4)(p,{key:3,width:90,type:"circle",percentage:o.percentage},null,8,["percentage"])):(0,l.kq)("",!0)])):(0,l.kq)("",!0)])]),(0,l._)("div",ue,[ne,(0,l.Wm)(n,{modelValue:o.note,"onUpdate:modelValue":t[4]||(t[4]=e=>o.note=e),rows:5,type:"textarea",placeholder:"输入备注内容"},null,8,["modelValue"])]),(0,l._)("div",re,[(0,l.Wm)(r,{type:"primary",onClick:u.submit,loading:o.submitting},{default:(0,l.w5)((()=>[de])),_:1},8,["onClick","loading"])])])),[[w,o.loading]]),o.showReg?((0,l.wg)(),(0,l.j4)(g,{key:0,title:"请选择要操作的农资",default:"1",kc:"1",selected:o.selected,onOnSubmit:u.onRegSubmit,onCloseReg:u.closeReg},null,8,["selected","onOnSubmit","onCloseReg"])):(0,l.kq)("",!0)])),[[w,o.loading]])])),_:1},8,["before-close","modelValue"])])}var me=a(3483),pe=a(9737),ge={name:"stockPut",data(){return{showBatchBox:!0,loading:!1,list:[],defaultType:"",backUser:"",typeList:[],userlist:[],userName:"",num:"",outInTime:new Date,note:"",showReg:!1,uploading:!1,imgs:[],percentage:0,submitting:!1,selected:[]}},components:{StockReg:U.Z},mounted(){let e=this;const t=async function(){e.loading=!0,await e.getPutTypeList(),await e.getUserList(),e.loading=!1};t()},methods:{onClose(){this.$emit("closeBathBox",0),this.showBatchBox=!1},getPutTypeList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/getStorageType").then((t=>{this.typeList=t.data,t.data.map((e=>{"已领用退回"==e.title&&(this.backUser=e.id)})),e()}))}))},getUserList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/task/getOrganizationUsers").then((t=>{this.userlist=t.data,e()}))}))},back(){this.$router.push("/erp/stock")},closeReg(){let e=setTimeout((()=>{this.showReg=!1,clearTimeout(e)}),500)},add(){this.selected=this.list.map((e=>e.agriculturalBo.id)),this.showReg=!0},onRegSubmit(e){let t=[];e.map((e=>{let a=!1;this.list.map((t=>{e.id==t.id&&(a=!0)})),a||(e.agriculturalBo=JSON.parse(JSON.stringify(e)),t.push(e))})),this.list=[...this.list,...t]},uploadFile(){this.uploading=!0;let e=this.$refs.file.files[0];(0,me.Z)(e,`erp/batchMaterialsInto/${e.name}`).then((e=>{e.url&&(this.imgs.push(e.url),this.uploading=!1,this.percentage=0)}))},removeImg(e){console.log(e),this.imgs.splice(e,1)},submit(){let e=-1,t="",a=this.list.map(((a,l)=>(a.num||-1!=e||(e=l,t=a.agriculturalBo.title),{agriculturalCount:a.num,id:a.id,title:a.agriculturalBo.title})));pe.T.confirm(`农资名称：${a.map((e=>e.title)).join("、")} <br> 确定要入库吗？`,"批量入库",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((()=>{if(0==this.list.length)return void this.$message.warning("请添加农资");if(e>-1)return void this.$message.warning(`请输入 [ ${t} ] 的入库数量`);if(!this.defaultType)return void this.$message.warning("请选择入库类型");if(!this.outInTime)return void this.$message.warning("请选择入库时间");if(this.defaultType==this.backUser&&!this.userName)return void this.$message.warning("请输入退回人");if(this.imgs.length<=0)return void this.$message.warning("请上传凭证");let l="";this.typeList.map((e=>{e.id==this.defaultType&&(l=e.title)}));let i="";this.userName&&this.userlist.map((e=>{e.id==this.userName&&(i=e.name)})),this.submitting=!0,this.ajax.post("/api/v1/adam/farmLand/saveAgriculturalStorage",{agriculturalOutInBos:a,image:this.imgs.join(","),outInTime:this.outInTime,remark:this.note,type:0,workAid:this.userName,username:i,workType:this.defaultType,workTypeName:l}).then((e=>{200==e.code?(this.onClose(),this.$message.success("入库成功！"),this.$emit("load")):this.$message.error("操作失败，请联系管理员！")}))})).catch((()=>{}))}}};const he=(0,D.Z)(ge,[["render",ce],["__scopeId","data-v-49d4fb4c"]]);var we=he,fe={name:"purchaseOrder",components:{StockDetail:W,StockReg:U.Z,StockPutBatch:we},data(){return{loading:!1,searchKey:"",searchLoading:!1,list:[],classifyList:[],defaultClassify:"0",defaultStatus:"-1",currentPage:1,pageSize:10,total:2,currentDetailId:"",showDetailBox:!1,showReg:!1,showBatch:!1}},mounted(){let e=this;const t=async function(){await e.getData(),await e.getClassify()};t()},methods:{getData(){return new Promise(((e,t)=>{this.loading=!0,this.ajax.post("/api/v1/adam/farmLand/agriculturalSearch-list",{pageNum:this.currentPage,pageSize:this.pageSize,param:{categoryId:this.defaultClassify,inventory:this.defaultStatus,keyWord:this.searchKey}}).then((t=>{this.list=t.data.map((e=>(e.agriculturalBo=e.agriculturalBo||{},e))),this.currentPage=t.pageNum,this.pageSize=t.pageSize,this.total=t.total,this.loading=!1,e()}))}))},getClassify(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/getAgriculturalCategory").then((t=>{this.classifyList=t.data,e()}))}))},selectByStatus(e){this.defaultStatus=e,this.getData()},selectByClassify(e){this.defaultClassify=e,this.getData()},viewDetail(e){this.showDetailBox=!0,this.currentDetailId=e},stock(e,t){this.$router.push({path:"/erp/stock/"+(e?"put":"out"),query:{id:t}})},closeDetailBox(){let e=setTimeout((()=>{this.showDetailBox=!1,this.currentDetailId="",clearTimeout(e)}),500)},closeReg(){let e=setTimeout((()=>{this.showReg=!1,clearTimeout(e)}),500)},onRegSave(){this.getData()},showCar(e){this.showCarBox=!0},closeCarBox(){let e=setTimeout((()=>{this.showCarBox=!1,clearTimeout(e)}),500)},closeBathBox(){let e=setTimeout((()=>{this.showBatch=!1,clearTimeout(e)}),500)},gotoRecord(){this.$router.push("/erp/stock/record")}}};const ye=(0,D.Z)(fe,[["render",_],["__scopeId","data-v-492a6c96"]]);var ke=ye},6799:function(e,t,a){a.d(t,{Z:function(){return C}});var l=a(6252),i=a(9963),s=a(3577);const o=e=>((0,l.dD)("data-v-d7157102"),e=e(),(0,l.Cn)(),e),u={class:"stockReg"},n={class:"stockRegBoxInner"},r={class:"form"},d={class:"formBox"},c={style:{display:"flex",width:"450px"}},m=o((()=>(0,l._)("span",null,"/",-1))),p={class:"submit"},g=(0,l.Uk)("提交"),h={class:"_import"},w={class:"search"},f=(0,l.Uk)("查询"),y={class:"submit"},k=(0,l.Uk)("提交");function _(e,t){const a=(0,l.up)("el-dialog"),o=(0,l.up)("el-input"),_=(0,l.up)("el-form-item"),v=(0,l.up)("el-option"),b=(0,l.up)("el-select"),B=(0,l.up)("el-col"),C=(0,l.up)("el-form"),x=(0,l.up)("el-button"),D=(0,l.up)("el-table-column"),V=(0,l.up)("el-table"),W=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",u,[(0,l.Wm)(a,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showDetailBox,"onUpdate:modelValue":t[2]||(t[2]=t=>e.showDetailBox=t),title:"请选择登记方式",width:"400px"},{default:(0,l.w5)((()=>[(0,l._)("div",n,[e.$store.state.power.addMaterialsInfo?((0,l.wg)(),(0,l.iD)("p",{key:0,onClick:t[0]||(t[0]=(...t)=>e.input&&e.input(...t))},"手动输入农资信息")):(0,l.kq)("",!0),e.$store.state.power.selectMaterialsInfo?((0,l.wg)(),(0,l.iD)("p",{key:1,onClick:t[1]||(t[1]=(...t)=>e._import&&e._import(...t))},"选择平台农资信息")):(0,l.kq)("",!0)])])),_:1},8,["before-close","modelValue"]),(0,l.Wm)(a,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showInput,"onUpdate:modelValue":t[10]||(t[10]=t=>e.showInput=t),title:"手动输入农资信息",width:"600px"},{default:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l._)("div",d,[(0,l.Wm)(C,{model:e.form,"label-width":"70px"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{label:"农资名称"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:e.form.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.title=t),placeholder:"请输入农资名称"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(_,{label:"农资类型"},{default:(0,l.w5)((()=>[(0,l._)("div",c,[(0,l.Wm)(b,{onChange:e.selectType,style:{width:"100%"},modelValue:e.defaultType,"onUpdate:modelValue":t[4]||(t[4]=t=>e.defaultType=t),placeholder:"请选择农资类型"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.typeList,(e=>((0,l.wg)(),(0,l.j4)(v,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"]),(0,l.wy)((0,l.Wm)(o,{style:{width:"180px","margin-left":"10px"},modelValue:e.form.definition,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.definition=t),placeholder:"请输入农资类型"},null,8,["modelValue"]),[[i.F8,e.definition]])])])),_:1}),(0,l.Wm)(_,{label:"生产厂家"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:e.form.company,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.company=t),placeholder:"请输入生产厂家"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(_,{label:"规格"},{default:(0,l.w5)((()=>[(0,l.Wm)(B,{span:18},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{modelValue:e.form.weightNum,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.weightNum=t),placeholder:"请输入规格",class:"input-with-select"},{append:(0,l.w5)((()=>[(0,l.Wm)(b,{modelValue:e.defaultWeight,"onUpdate:modelValue":t[7]||(t[7]=t=>e.defaultWeight=t),placeholder:"-",style:{width:"75px"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.weightList,(e=>((0,l.wg)(),(0,l.j4)(v,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(B,{span:2,style:{"text-align":"center"}},{default:(0,l.w5)((()=>[m])),_:1}),(0,l.Wm)(B,{span:4},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{modelValue:e.defaultUnit,"onUpdate:modelValue":t[9]||(t[9]=t=>e.defaultUnit=t),placeholder:"-",style:{width:"75px"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.unitList,(e=>((0,l.wg)(),(0,l.j4)(v,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])]),(0,l._)("div",p,[(0,l.Wm)(x,{type:"primary",onClick:e.submitA,loading:e.saveing},{default:(0,l.w5)((()=>[g])),_:1},8,["onClick","loading"])])])])),_:1},8,["before-close","modelValue"]),(0,l.Wm)(a,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showImport,"onUpdate:modelValue":t[12]||(t[12]=t=>e.showImport=t),title:e.title||"选择平台农资信息",width:"800px"},{default:(0,l.w5)((()=>[(0,l._)("div",h,[(0,l._)("div",w,[(0,l.Wm)(o,{modelValue:e.searchKey,"onUpdate:modelValue":t[11]||(t[11]=t=>e.searchKey=t),style:{width:"360px"},placeholder:"关键字搜索：农资类型、农资名称、厂家名称"},null,8,["modelValue"]),(0,l.Wm)(x,{style:{"margin-left":"10px"},type:"primary",plain:"",onClick:e.getData},{default:(0,l.w5)((()=>[f])),_:1},8,["onClick"])]),(0,l.wy)(((0,l.wg)(),(0,l.j4)(V,{size:"large",data:e.tableData,ref:"table","max-height":"500",style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{selectable:e.selectable,type:"selection",width:"55"},null,8,["selectable"]),(0,l.Wm)(D,{prop:"title",label:"农资名称"}),(0,l.Wm)(D,{prop:"agriculturalCategory",label:"农资类型",width:"150"}),(0,l.Wm)(D,{prop:"manufacturers",label:"生产厂家"}),(0,l.Wm)(D,{label:"规格",width:"150"},{default:(0,l.w5)((e=>[(0,l.Uk)((0,s.zw)(e.row.agriculturalCount)+(0,s.zw)(e.row.unitweight)+"/"+(0,s.zw)(e.row.unitmeasurement),1)])),_:1})])),_:1},8,["data"])),[[W,e.loading]]),(0,l._)("div",y,[(0,l.Wm)(x,{type:"primary",onClick:e.submitB,loading:e.submitting},{default:(0,l.w5)((()=>[k])),_:1},8,["onClick","loading"])])])])),_:1},8,["before-close","modelValue","title"])])}var v={name:"stockReg",props:["default","needSubmit","title","selected","kc"],data(){return{loading:!1,showDetailBox:!0,showInput:!1,showImport:!1,form:{},defaultType:"",typeList:[],defaultUnit:"",unitList:[],defaultWeight:"",weightList:[],searchKey:"",tableData:[],saveing:!1,submitting:!1,definition:!1}},mounted(){0==this.default&&this.input(),1==this.default&&this._import()},methods:{selectable(e,t){return!this.selected||!this.selected.includes(e.id)},selectType(e){this.typeList.map((t=>{t.id==e&&"自定义"==t.title&&(this.definition=!0)}))},onClose(){this.$emit("closeReg",0),this.showDetailBox=!1,this.showInput=!1,this.showImport=!1},input(){let e=this;e.showDetailBox=!1,e.showInput=!0,e.showImport=!1;const t=async function(){await e.getTypeList(),await e.getUnitList(),await e.getWeightList()};t()},_import(){this.showDetailBox=!1,this.showInput=!1,this.showImport=!0,this.getData()},getData(){this.loading=!0;let e=1==this.kc?"/api/v1/adam/farmLand/agriculturalSearch-list":"/api/v1/adam/agricultural/platform-list";this.ajax.post(e,{pageNum:1,pageSize:100,param:{categoryId:0,inventory:0,keyWord:this.searchKey}}).then((e=>{this.loading=!1,this.tableData=e.data.map((e=>1==this.kc?(e.agriculturalBo=e.agriculturalBo||{},e.agriculturalBo):(e.agriculturalBo=e.agriculturalBo||{},e))),this.selected&&this.$nextTick((()=>{this.tableData.map((e=>{this.selected.includes(e.id)&&this.$refs.table.toggleRowSelection(e,!0)}))}))}))},getTypeList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getAgriculturalCategory").then((t=>{this.typeList=t.data,e()}))}))},getUnitList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getUnitMeasurement").then((t=>{this.unitList=t.data,e()}))}))},getWeightList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getWeightUnit").then((t=>{this.weightList=t.data,e()}))}))},submitA(){let e="",t=null;this.definition?e=this.form.definition:(t=this.defaultType,this.typeList.map((t=>{t.id==this.defaultType&&(e=t.title)})));let a="";this.weightList.map((e=>{e.id==this.defaultWeight&&(a=e.title)}));let l="";this.unitList.map((e=>{e.id==this.defaultUnit&&(l=e.title)}));let i={agriculturalCategory:e,agriculturalCategoryId:t,title:this.form.title,manufacturers:this.form.company,agriculturalCount:this.form.weightNum,unitweight:a,unitweightid:this.defaultWeight,unitmeasurement:l,unitmeasurementid:this.defaultUnit,definition:this.definition?1:0};this.saveing=!0,this.ajax.post("/api/v1/adam/farmLand/saveDefinition",{agriculturalBoList:[i]}).then((e=>{this.saveing=!1,200==e.code&&(this.$message.success("保存成功"),this.$emit("onSave"),this.onClose())}))},submitB(){if("undefined"==typeof this.needSubmit)this.$emit("onSubmit",this.$refs.table.getSelectionRows()),this.onClose();else{let e=this.$refs.table.getSelectionRows().map((e=>e.id));if(0==e.length)return void this.$message.warning("请选择农资");this.submitting=!0,this.ajax.post("/api/v1/adam/farmLand/savePlatform",{id:e}).then((e=>{this.submitting=!1,200==e.code?(this.$message.success("保存成功"),this.$emit("onSave"),this.onClose()):this.$message.warning(e.message)}))}}}},b=a(8118);const B=(0,b.Z)(v,[["render",_],["__scopeId","data-v-d7157102"]]);var C=B}}]);
//# sourceMappingURL=270.3f95d4f2.js.map