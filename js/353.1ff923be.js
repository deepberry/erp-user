"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[353],{4274:function(t,e,a){a.d(e,{Z:function(){return y}});var l=a(6252),r=a(3577);const i=t=>((0,l.dD)("data-v-09ed84dc"),t=t(),(0,l.Cn)(),t),o={class:"purchaseDetailBox"},u={class:"purchaseDetailBoxInner"},s=(0,l.Uk)("删除"),n={class:"bottom"},c=i((()=>(0,l._)("div",null,"合计：",-1))),d=i((()=>(0,l._)("span",null,"总价",-1))),p={class:"buttons"},h=(0,l.Uk)("联系客服"),w=(0,l.Uk)("提交订单");function g(t,e,a,i,g,m){const C=(0,l.up)("el-table-column"),b=(0,l.up)("el-input"),v=(0,l.up)("el-button"),y=(0,l.up)("el-table"),f=(0,l.up)("el-dialog"),D=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",o,[(0,l.Wm)(f,{"custom-class":"purchaseDetailBox","before-close":m.onClose,"append-to-body":"",modelValue:g.showCarBox,"onUpdate:modelValue":e[0]||(e[0]=t=>g.showCarBox=t),title:"购物车",width:"900px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",u,[(0,l.Wm)(y,{size:"large",ref:"table",onSelect:m.select,onSelectAll:m.select,data:g.list,style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{type:"selection",width:"40"}),(0,l.Wm)(C,{prop:"agriculturalBo.title",label:"农资名称","show-overflow-tooltip":""}),(0,l.Wm)(C,{prop:"agriculturalBo.agriculturalCategory",label:"农资类型","show-overflow-tooltip":""}),(0,l.Wm)(C,{prop:"agriculturalBo.manufacturers",label:"生产厂家","show-overflow-tooltip":""}),(0,l.Wm)(C,{label:"规格",width:"140"},{default:(0,l.w5)((t=>[(0,l.Uk)(" ("+(0,r.zw)(t.row.agriculturalBo.agriculturalCount+t.row.agriculturalBo.unitweight+"/"+t.row.agriculturalBo.unitmeasurement)+") ",1)])),_:1}),(0,l.Wm)(C,{width:"120",label:"价格","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)(" ￥"+(0,r.zw)(t.row.agriculturalBo.agriculturalPrice),1)])),_:1}),(0,l.Wm)(C,{width:"120",label:"数量","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Wm)(b,{type:"number",modelValue:t.row.unit,"onUpdate:modelValue":e=>t.row.unit=e,style:{width:"60px"},size:"small",placeholder:"数量",onBlur:e=>m.resetCarCount(t.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),(0,l.Uk)(" "+(0,r.zw)(t.row.agriculturalBo.unitmeasurement),1)])),_:1}),(0,l.Wm)(C,{width:"120",label:"操作","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Wm)(v,{size:"small",type:"primary",onClick:e=>m.remove(t)},{default:(0,l.w5)((()=>[s])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["onSelect","onSelectAll","data"]),(0,l._)("div",n,[c,(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(g.totalList,(t=>((0,l.wg)(),(0,l.iD)("p",{key:t.title},[(0,l._)("span",null,(0,r.zw)(t.title),1),(0,l._)("span",null,(0,r.zw)(t.num)+(0,r.zw)(t.unit),1)])))),128)),(0,l._)("p",null,[d,(0,l._)("span",null,"￥"+(0,r.zw)(m.allPrice)+".00元",1)])])]),(0,l._)("div",p,[(0,l.Wm)(v,{type:"primary",round:"",plain:"",onClick:m.showServer},{default:(0,l.w5)((()=>[h])),_:1},8,["onClick"]),t.$store.state.power.submitShoppingOrderBtn?((0,l.wg)(),(0,l.j4)(v,{key:0,type:"primary",onClick:m.submit,loading:g.submitting},{default:(0,l.w5)((()=>[w])),_:1},8,["onClick","loading"])):(0,l.kq)("",!0)])])),[[D,g.carLoading]])])),_:1},8,["before-close","modelValue"])])}var m={total(t,e){let a=t.map((t=>this.findAttr(t,e))),l=Array.from(new Set(a)),r=l.map((a=>{let l={title:a,num:0};return t.map((t=>{this.findAttr(t,e)==a&&(l.num+=t.agriculturalBo.agriculturalCount*t.unit)})),l}));return r},findAttr(t,e){let a=e.split("."),l=JSON.parse(JSON.stringify(a));return l.map((e=>{t=t[a[0]],a.shift()})),t}},C={name:"purchaseOrderCar",props:["id"],data(){return{list:[],selected:[],showCarBox:!0,detail:{},carLoading:!1,totalList:[],submitting:!1}},computed:{allPrice(){let t=0;return this.selected.map((e=>{t+=e.agriculturalBo.agriculturalPrice*e.unit})),t}},watch:{allPrice(){this.totalList=m.total(this.selected,"agriculturalBo.title"),this.totalList=this.totalList.map((t=>(this.list.map((e=>{e.agriculturalBo.title==t.title&&(t.unit=e.agriculturalBo.unitweight)})),t)))}},mounted(){this.getCar()},methods:{remove(t){let e=t.$index,a=t.row.id;this.ajax.post("/api/v1/adam/agricultural/cart-del",{id:a}).then((t=>{this.list.splice(e,1)}))},select(t){console.log(t),this.selected=t},getCar(){this.carLoading=!0,this.ajax.post("/api/v1/adam/agricultural/cart",{pageNum:0,pageSize:0,param:{keyWord:"",orderStatus:0}}).then((t=>{let e=[];t.data.map((t=>{t.unit>0&&e.push(t)})),this.list=e,this.carLoading=!1}))},onClose(){this.$emit("closeCarBox",0),this.showCarBox=!1},showServer(){this.$alert("客服电话：13606870818","联系客服")},resetCarCount(t){this.ajax.post("/api/v1/adam/agricultural/cart-update",{agriculturalId:t.agriculturalBo.id,id:t.id,unit:t.unit})},submit(){let t=this;if(0==t.$refs.table.getSelectionRows().length)return void t.$message.warning("请选择农资");let e=[],a=t.$refs.table.getSelectionRows().map((t=>(e.push({agriculturalCos:t.agriculturalBo.agriculturalCount*t.agriculturalBo.agriculturalPrice,id:t.agriculturalBo.agriculturalCategoryId,title:t.agriculturalBo.title,unitweight:t.agriculturalBo.agriculturalCount}),{agriculturalId:t.agriculturalBo.id,id:t.id,unit:t.unit})));t.submitting=!0,t.ajax.post("/api/v1/adam/agricultural/saveOrder",{orderCartBoList:a,orderCos:t.allPrice,totalCount:e}).then((e=>{t.submitting=!1,200==e.code?(t.$message.success("提交成功"),t.onClose()):t.$message.error(e.message)}))}}},b=a(8118);const v=(0,b.Z)(C,[["render",g],["__scopeId","data-v-09ed84dc"]]);var y=v},5353:function(t,e,a){a.r(e),a.d(e,{default:function(){return M}});var l=a(6252),r=a(3577);const i=t=>((0,l.dD)("data-v-dc5c5d10"),t=t(),(0,l.Cn)(),t),o={class:"purchaseOrder"},u={class:"ctrl"},s={class:"status"},n={class:"search"},c=(0,l.Uk)("查询"),d=(0,l.Uk)("去采购"),p=i((()=>(0,l._)("i",{class:"erp erpgouwuche"},null,-1))),h=(0,l.Uk)(" 购物车"),w={class:"tableWrap"},g={class:"table"},m=i((()=>(0,l._)("br",null,null,-1))),C=i((()=>(0,l._)("br",null,null,-1))),b=i((()=>(0,l._)("br",null,null,-1))),v=(0,l.Uk)("查看详情"),y={key:0,class:"pages"},f={class:"total"};function D(t,e){const a=(0,l.up)("el-button"),i=(0,l.up)("el-input"),D=(0,l.up)("el-badge"),_=(0,l.up)("el-table-column"),B=(0,l.up)("el-table"),k=(0,l.up)("el-pagination"),x=(0,l.up)("PurchaseOrderDetail"),z=(0,l.up)("PurchaseCar"),S=(0,l.Q2)("loading");return(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",o,[(0,l._)("div",u,[(0,l._)("div",s,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.status,(e=>((0,l.wg)(),(0,l.j4)(a,{onClick:a=>t.changeStatus(e),key:e.value,class:"statusItem",type:t.currentStatus==e.value?"primary":"",link:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(e.title),1)])),_:2},1032,["onClick","type"])))),128))]),(0,l._)("div",n,[(0,l.Wm)(i,{modelValue:t.searchKey,"onUpdate:modelValue":e[0]||(e[0]=e=>t.searchKey=e),class:"searchInput",placeholder:"关键词搜索：农资类型、农资名称、厂家名称"},null,8,["modelValue"]),(0,l.Wm)(a,{type:"primary",class:"searchSubmit",onClick:t.getData},{default:(0,l.w5)((()=>[c])),_:1},8,["onClick"]),(0,l.Wm)(a,{type:"primary",class:"searchSubmit",onClick:t.gotoPurchase},{default:(0,l.w5)((()=>[d])),_:1},8,["onClick"]),(0,l.Wm)(D,{value:t.carCount,class:"item",onClick:t.showCar},{default:(0,l.w5)((()=>[(0,l.Wm)(a,{type:"primary",class:"searchCreateNewTask",plain:""},{default:(0,l.w5)((()=>[p,h])),_:1})])),_:1},8,["value","onClick"])])]),(0,l._)("div",w,[(0,l._)("div",g,[(0,l.Wm)(B,{size:"large",data:t.list,style:{width:"100%"},"max-height":"600px"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{prop:"orderUuid",label:"订单号","show-overflow-tooltip":"",width:"200"}),(0,l.Wm)(_,{label:"农资名称","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.row.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("span",{key:e},[(0,l.Uk)((0,r.zw)(t.titleVerity)+" ",1),m])))),128))])),_:1}),(0,l.Wm)(_,{label:"农资类型"},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.row.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("span",{key:e},[(0,l.Uk)((0,r.zw)(t.title)+" ",1),C])))),128))])),_:1}),(0,l.Wm)(_,{label:"数量"},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.row.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("span",{key:e},[(0,l.Uk)((0,r.zw)(t.unitCount)+" "+(0,r.zw)(t.unitdict)+"（共"+(0,r.zw)(t.weightCount)+(0,r.zw)(t.unitweight)+"）",1),b])))),128))])),_:1}),(0,l.Wm)(_,{prop:"userName",label:"提交人","show-overflow-tooltip":"",width:"200"}),(0,l.Wm)(_,{prop:"orderStatus",label:"状态"},{default:(0,l.w5)((t=>[(0,l._)("span",{style:(0,r.j5)({color:t.row.orderStatusColor})},(0,r.zw)(t.row.orderStatus),5)])),_:1}),(0,l.Wm)(_,{label:"操作",width:"180"},{default:(0,l.w5)((e=>[t.$store.state.power.purchaseOrderDetail?((0,l.wg)(),(0,l.j4)(a,{key:0,link:"",type:"primary",onClick:a=>t.viewDetail(e.row.id)},{default:(0,l.w5)((()=>[v])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data"]),t.list.length>0?((0,l.wg)(),(0,l.iD)("div",y,[(0,l._)("span",f,"共 "+(0,r.zw)(t.total)+" 条",1),(0,l.Wm)(k,{currentPage:t.currentPage,"onUpdate:currentPage":e[1]||(e[1]=e=>t.currentPage=e),"page-size":t.pageSize,"onUpdate:page-size":e[2]||(e[2]=e=>t.pageSize=e),background:"",onCurrentChange:t.getData,layout:"prev, pager, next, jumper",total:t.total},null,8,["currentPage","page-size","onCurrentChange","total"])])):(0,l.kq)("",!0)])]),t.showDetailBox?((0,l.wg)(),(0,l.j4)(x,{key:0,id:t.currentDetailId,onCloseDetailBox:t.closeDetailBox},null,8,["id","onCloseDetailBox"])):(0,l.kq)("",!0),t.showCarBox?((0,l.wg)(),(0,l.j4)(z,{key:1,onCloseCarBox:t.closeCarBox},null,8,["onCloseCarBox"])):(0,l.kq)("",!0)])),[[S,t.loading]])}const _=t=>((0,l.dD)("data-v-4547657a"),t=t(),(0,l.Cn)(),t),B={class:"purchaseDetailBox"},k={class:"purchaseDetailBoxInner"},x={class:"item"},z={class:"item"},S={class:"tag"},W={style:{color:"red"}},$={class:"bottom"},U=_((()=>(0,l._)("div",null,"合计：",-1))),P=_((()=>(0,l._)("span",null,"总价",-1)));function L(t,e,a,i,o,u){const s=(0,l.up)("el-table-column"),n=(0,l.up)("el-table"),c=(0,l.up)("el-dialog"),d=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",B,[(0,l.Wm)(c,{"custom-class":"purchaseDetailBox","before-close":u.onClose,"append-to-body":"",modelValue:o.showDetailBox,"onUpdate:modelValue":e[0]||(e[0]=t=>o.showDetailBox=t),title:"订单详情",width:"800px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",k,[(0,l._)("div",x,[(0,l._)("p",null,"订单号："+(0,r.zw)(o.detail.orderUuid),1),(0,l._)("p",{style:(0,r.j5)({color:o.detail.color})},(0,r.zw)(o.detail.status),5)]),(0,l._)("div",z,[(0,l._)("p",null,"提交人："+(0,r.zw)(o.detail.userName),1),(0,l._)("p",null,"提交时间："+(0,r.zw)(o.detail.orderTime),1)]),(0,l.Wm)(n,{size:"large",data:o.detail.agriculturalCartBos,style:{width:"100%","margin-top":"20px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(s,{prop:"agriculturalBo.title",label:"农资名称","show-overflow-tooltip":""}),(0,l.Wm)(s,{label:"类型","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l._)("span",S,(0,r.zw)(t.row.agriculturalBo.agriculturalCategory),1)])),_:1}),(0,l.Wm)(s,{prop:"id",label:"规格","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)((0,r.zw)(t.row.agriculturalBo.agriculturalCount+t.row.agriculturalBo.unitweight+"/"+t.row.agriculturalBo.unitmeasurement),1)])),_:1}),(0,l.Wm)(s,{prop:"agriculturalBo.manufacturers",label:"厂家","show-overflow-tooltip":""}),(0,l.Wm)(s,{label:"采购数量","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)((0,r.zw)(t.row.unit)+(0,r.zw)(t.row.agriculturalBo.unitmeasurement)+"（共"+(0,r.zw)(t.row.agriculturalCount)+(0,r.zw)(t.row.agriculturalBo.unitweight)+"） ",1)])),_:1}),(0,l.Wm)(s,{prop:"agriculturalBo.agriculturalPrice",label:"参考单价","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l._)("span",W,"￥"+(0,r.zw)(t.row.agriculturalBo.agriculturalPrice)+"元 ",1)])),_:1})])),_:1},8,["data"]),(0,l._)("div",$,[U,(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.detail.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("p",{key:e},[(0,l._)("span",null,(0,r.zw)(t.title),1),(0,l._)("span",null,(0,r.zw)(t.unitCount)+(0,r.zw)(t.unitdict)+" 共（"+(0,r.zw)(t.unitCount*t.weightCount)+(0,r.zw)(t.unitweight)+"） ",1)])))),128)),(0,l._)("p",null,[P,(0,l._)("span",null,"￥"+(0,r.zw)(o.detail.orderCos)+"元",1)])])])])),[[d,o.detailLoading]])])),_:1},8,["before-close","modelValue"])])}var I=a(2335),N={name:"purchaseOrderDetail",props:["id"],data(){return{showDetailBox:!0,detail:{},detailLoading:!1}},mounted(){this.detailLoading=!0,this.ajax.post("/api/v1/adam/agricultural/orderDetail",{id:this.id}).then((t=>{let e="",a="";switch(t.data.orderStatus){case 0:e="已提交",a="#1890FF";break;case 1:e="已完成",a="#0DD71C";break;case 2:e="已关闭",a="#A8A8A8";break}t.data.status=e,t.data.color=a,t.data.orderTime=I.Z.time("y-m-d h:i:s",t.data.orderTime),this.detail=t.data,this.detailLoading=!1}))},methods:{onClose(){this.$emit("closeDetailBox",0),this.showDetailBox=!1}}},T=a(8118);const j=(0,T.Z)(N,[["render",L],["__scopeId","data-v-4547657a"]]);var V=j,A=a(4274),O={name:"purchaseOrder",components:{PurchaseOrderDetail:V,PurchaseCar:A.Z},data(){return{loading:!1,searchKey:"",carCount:0,status:[{title:"全部",value:"-1"},{title:"已提交",value:"0"},{title:"已完成",value:"1"},{title:"已关闭",value:"2"}],currentStatus:"-1",list:[],currentPage:1,pageSize:10,total:0,showDetailBox:!1,currentDetailId:"",showCarBox:!1}},mounted(){this.getData(),this.getCarCount()},methods:{getCarCount(){return new Promise(((t,e)=>{this.ajax.post("/api/v1/adam/agricultural/cart-count").then((e=>{this.carCount=e.data||"",t()}))}))},getData(){this.loading=!0,this.ajax.post("/api/v1/adam/agricultural/order-list",{pageNum:this.currentPage,pageSize:10,param:{keyWord:this.searchKey,orderStatus:this.currentStatus}}).then((t=>{this.list=t.data.map((t=>{let e="",a="";switch(t.orderStatus){case 0:e="已提交",a="#1890FF";break;case 1:e="已完成",a="#0DD71C";break;case 2:e="已关闭",a="#A8A8A8";break}return t.orderStatus=e,t.orderStatusColor=a,t})),this.total=t.total,this.loading=!1}))},changeStatus(t){this.currentStatus=t.value,this.getData()},gotoPurchase(){this.$router.push("/erp/purchase/shop")},viewDetail(t){this.showDetailBox=!0,this.currentDetailId=t},closeDetailBox(){let t=setTimeout((()=>{this.showDetailBox=!1,this.currentDetailId="",clearTimeout(t)}),500)},showCar(t){this.showCarBox=!0},closeCarBox(){let t=setTimeout((()=>{this.showCarBox=!1,clearTimeout(t)}),500)}}};const K=(0,T.Z)(O,[["render",D],["__scopeId","data-v-dc5c5d10"]]);var M=K},2335:function(t,e){const a={to2:t=>Number(t)<10?`0${Number(t)}`:String(t),time(t="y-m-d",e=null){let a=e?new Date(e):new Date;return t=t.replace("y",a.getFullYear()),t=t.replace("m",this.to2(a.getMonth()+1)),t=t.replace("d",this.to2(a.getDate())),t=t.replace("h",this.to2(a.getHours())),t=t.replace("i",this.to2(a.getMinutes())),t=t.replace("s",this.to2(a.getSeconds())),t=t.replace("w",a.getDay()),t},monthLength(t=null){let e=1*this.time("y",t),a=this.to2(1*this.time("m",t)+1);if(13==a)return 31;{let t=new Date(`${e}-${a}-01`).getTime()-864e5;return Number(this.time("d",t))}},preMonthLenggth(t=null){let e=1*this.time("y",t),a=this.to2(1*this.time("m",t)),l=new Date(`${e}-${a}-01`).getTime()-864e5;return Number(this.time("d",l))},nextMonthLenggth(t=null){let e=1*this.time("y",t),a=this.to2(1*this.time("m",t)+2),l=new Date(`${e}-${a}-01`).getTime()-864e5;return Number(this.time("d",l))},monthFirst(t=null){let e=this.time("y-m",t)+"-01";return this.time("y-m-d",e)},monthLast(t=null){let e=1*this.time("y",t),a=this.to2(1*this.time("m",t)+1),l=new Date(`${e}-${a}-01`).getTime()-864e5;return this.time("y-m-d",l)},preMonthToday(t=null){let e=Number(t.substr(0,4)),a=Number(t.substr(5,2)),l=Number(t.substr(8));return l>this.preMonthLenggth(`{y}-${a}-01`)&&(l=this.preMonthLenggth(`{y}-${a}-01`)),1==a?(e-=1,a=12):a-=1,`${e}-${a}-${l}`},nextMonthToday(t=null){let e=Number(t.substr(0,4)),a=Number(t.substr(5,2)),l=Number(t.substr(8));return l>this.nextMonthLenggth(`{y}-${a}-01`)&&(l=this.nextMonthLenggth(`{y}-${a}-01`)),12==a?(e+=1,a=1):a+=1,`${e}-${a}-${l}`},timeout(t){},timeRemaining(t,e){return e-=parseInt((new Date).getTime()/1e3),this.unixToString(t,e)},unixToString(t,e){let l=parseInt(e/60/60/24),r=parseInt((e-86400*l)/3600),i=parseInt((e-86400*l-3600*r)/60),o=e-86400*l-3600*r-60*i;return t=t.replace("d",a.to2(a.low(l))),t=t.replace("h",a.to2(a.low(r))),t=t.replace("i",a.to2(a.low(i))),t=t.replace("s",a.to2(a.low(o))),t},low(t){return t<0?0:t},parse(t){return new Date(t)}};e["Z"]=a}}]);
//# sourceMappingURL=353.1ff923be.js.map