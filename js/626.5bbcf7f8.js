"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[626],{7987:function(e,t,a){a.d(t,{Z:function(){return c}});var l=a(6252);const i={style:{"margin-top":"20px"}},s={style:{"margin-top":"20px","text-align":"center"}},r=(0,l.Uk)("保存"),o=(0,l.Uk)("保存并继续添加");function n(e,t,a,n,u,d){const m=(0,l.up)("el-input"),c=(0,l.up)("el-button"),p=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.j4)(p,{"before-close":d.onClose,"append-to-body":"",modelValue:u.showBox,"onUpdate:modelValue":t[2]||(t[2]=e=>u.showBox=e),title:u.title,width:"400px"},{default:(0,l.w5)((()=>[(0,l._)("div",null,[(0,l.Wm)(m,{modelValue:u.name,"onUpdate:modelValue":t[0]||(t[0]=e=>u.name=e),placeholder:"请输入名称"},null,8,["modelValue"])]),(0,l._)("div",i,[(0,l.Wm)(m,{modelValue:u.num,"onUpdate:modelValue":t[1]||(t[1]=e=>u.num=e),placeholder:"请输入数量"},null,8,["modelValue"])]),(0,l._)("div",s,[(0,l.Wm)(c,{type:"primary",onClick:d.save},{default:(0,l.w5)((()=>[r])),_:1},8,["onClick"]),(0,l.Wm)(c,{type:"primary",text:"",onClick:d.save2},{default:(0,l.w5)((()=>[o])),_:1},8,["onClick"])])])),_:1},8,["before-close","modelValue","title"])}var u={props:["type"],data(){return{showBox:!0,title:"",name:"",num:""}},mounted(){this.title="添加"+(1==this.type?"虫子":"天敌")},methods:{save(){let e=this.save2();e&&this.$emit("close")},save2(){return console.log(this.type),this.name?this.num?(this.$emit("save",{type:this.type,name:this.name,num:this.num}),this.name="",this.num="",!0):(this.$message.error("请输入数量"),!1):(this.$message.error("请输入名称"),!1)},onClose(){this.showBox=!1,this.$emit("close")}}},d=a(8118);const m=(0,d.Z)(u,[["render",n]]);var c=m},7702:function(e,t,a){a.d(t,{Z:function(){return F}});var l=a(6252),i=a(3577),s=a(9963);const r=e=>((0,l.dD)("data-v-6fae29c1"),e=e(),(0,l.Cn)(),e),o={class:"main"},n={class:"tab"},u={class:"tabbox tab1"},d=["onClick"],m={class:"itemBox"},c={class:"tag"},p={key:0},g=(0,l.Uk)(" 使用量："),h={class:"btn"},w=(0,l.Uk)("    取消    "),f=(0,l.Uk)("    确定    "),y={class:"tabbox tab2"},v={class:"item"},k=r((()=>(0,l._)("div",{class:"title"},[(0,l._)("span",null,"*"),(0,l.Uk)(" 农资名称：")],-1))),_={class:"content"},D={class:"item"},C=r((()=>(0,l._)("div",{class:"title"},[(0,l._)("span",null,"*"),(0,l.Uk)(" 农资类型：")],-1))),B={class:"content"},b={class:"contentA"},U={key:0,class:"contentB"},V={class:"item"},x=r((()=>(0,l._)("div",{class:"title"},[(0,l._)("span",null,"*"),(0,l.Uk)(" 使用量：")],-1))),T={class:"content"},L={class:"contentA"},$={class:"contentB"},z={class:"item"},I=r((()=>(0,l._)("div",{class:"title"},"厂家：",-1))),N={class:"content"},j={class:"btn"},q=(0,l.Uk)("保存并继续添加"),E=(0,l.Uk)("    保存    ");function A(e,t,a,r,A,P){const W=(0,l.up)("el-empty"),M=(0,l.up)("el-input"),F=(0,l.up)("el-button"),H=(0,l.up)("el-option"),S=(0,l.up)("el-select"),G=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.j4)(G,{"before-close":P.onClose,"append-to-body":"",modelValue:A.showDetailBox,"onUpdate:modelValue":t[10]||(t[10]=e=>A.showDetailBox=e),title:"添加农资",width:"740px"},{default:(0,l.w5)((()=>[(0,l._)("div",o,[(0,l._)("div",n,[(0,l._)("span",{class:(0,i.C_)(0==A.tab?"active":""),onClick:t[0]||(t[0]=e=>A.tab=0)},"请选择农资",2),A.showTab2?((0,l.wg)(),(0,l.iD)("span",{key:0,class:(0,i.C_)(1==A.tab?"active":""),onClick:t[1]||(t[1]=e=>A.tab=1)},"手动输入农资信息",2)):(0,l.kq)("",!0)]),(0,l.wy)((0,l._)("div",u,[0==A.list.length?((0,l.wg)(),(0,l.j4)(W,{key:0,description:"暂无数据"})):(0,l.kq)("",!0),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(A.list,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"item",key:e.id},[(0,l._)("i",{onClick:t=>e.use=!e.use,class:(0,i.C_)(e.use||e.selected?"erp erpduoxuankuangxuanzhong":"erp erpduoxuan-01")},null,10,d),(0,l._)("div",m,[(0,l._)("div",null,[(0,l._)("span",null,[(0,l.Uk)((0,i.zw)(e.agriculturalBo.title)+" ",1),(0,l._)("span",c,(0,i.zw)(e.agriculturalBo.agriculturalCategory),1)]),(0,l._)("span",null,"("+(0,i.zw)(e.agriculturalBo.agriculturalCount)+(0,i.zw)(e.agriculturalBo.unitweight)+"/"+(0,i.zw)(e.agriculturalBo.unitmeasurement)+")",1),(0,l._)("span",null,(0,i.zw)(e.agriculturalBo.manufacturers),1)]),(0,l._)("div",null,[(0,l._)("span",null," 库存量： "+(0,i.zw)(e.agriculturalUnit)+(0,i.zw)(e.agriculturalBo.unitmeasurement)+"（共"+(0,i.zw)(e.agriculturalCount)+(0,i.zw)(e.agriculturalBo.unitweight)+"） ",1),"no"!=a.neednum?((0,l.wg)(),(0,l.iD)("div",p,[g,(0,l.Wm)(M,{style:{width:"160px"},onBlur:a=>e.useNum>e.agriculturalCount?P.inputNum(t):()=>{},modelValue:e.useNum,"onUpdate:modelValue":t=>e.useNum=t,placeholder:"输入数量"},{append:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.agriculturalBo.unitweight),1)])),_:2},1032,["onBlur","modelValue","onUpdate:modelValue"])])):(0,l.kq)("",!0)])])])))),128)),(0,l._)("div",h,[(0,l.Wm)(F,{type:"primary",plain:"",onClick:P.onClose},{default:(0,l.w5)((()=>[w])),_:1},8,["onClick"]),(0,l.Wm)(F,{type:"primary",onClick:P.chose},{default:(0,l.w5)((()=>[f])),_:1},8,["onClick"])])],512),[[s.F8,0==A.tab]]),(0,l.wy)((0,l._)("div",y,[(0,l._)("div",v,[k,(0,l._)("div",_,[(0,l.Wm)(M,{modelValue:A.title,"onUpdate:modelValue":t[2]||(t[2]=e=>A.title=e),placeholder:"请输入"},null,8,["modelValue"])])]),(0,l._)("div",D,[C,(0,l._)("div",B,[(0,l._)("div",b,[(0,l.Wm)(S,{style:{width:"100%"},modelValue:A.currentAgriculturalCategory,"onUpdate:modelValue":t[3]||(t[3]=e=>A.currentAgriculturalCategory=e),placeholder:"请选择农资类型"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(A.agriculturalCategory,(e=>((0,l.wg)(),(0,l.j4)(H,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),-1==A.currentAgriculturalCategory?((0,l.wg)(),(0,l.iD)("div",U,[(0,l.Wm)(M,{modelValue:A.diyAgriculturalCategory,"onUpdate:modelValue":t[4]||(t[4]=e=>A.diyAgriculturalCategory=e),placeholder:"请输入"},null,8,["modelValue"])])):(0,l.kq)("",!0)])]),(0,l._)("div",V,[x,(0,l._)("div",T,[(0,l._)("div",L,[(0,l.Wm)(M,{modelValue:A.useNum,"onUpdate:modelValue":t[5]||(t[5]=e=>A.useNum=e),placeholder:"请输入使用量"},null,8,["modelValue"])]),(0,l._)("div",$,[(0,l.Wm)(S,{style:{width:"100%"},modelValue:A.currentUnitMeasurement,"onUpdate:modelValue":t[6]||(t[6]=e=>A.currentUnitMeasurement=e),placeholder:"单位"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(A.unitMeasurement,(e=>((0,l.wg)(),(0,l.j4)(H,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])]),(0,l._)("div",z,[I,(0,l._)("div",N,[(0,l.Wm)(M,{modelValue:A.company,"onUpdate:modelValue":t[7]||(t[7]=e=>A.company=e),placeholder:"请输入厂家"},null,8,["modelValue"])])]),(0,l._)("div",j,[(0,l.Wm)(F,{type:"primary",plain:"",onClick:t[8]||(t[8]=e=>P.save(0))},{default:(0,l.w5)((()=>[q])),_:1}),(0,l.Wm)(F,{type:"primary",onClick:t[9]||(t[9]=e=>P.save(1))},{default:(0,l.w5)((()=>[E])),_:1})])],512),[[s.F8,1==A.tab]])])])),_:1},8,["before-close","modelValue"])}var P={props:["id","selected","neednum","from"],emits:["close","save","chose"],data(){return{showDetailBox:!0,tab:0,showTab2:!0,list:[],title:"",agriculturalCategory:[],currentAgriculturalCategory:"",diyAgriculturalCategory:"",unitMeasurement:[],currentUnitMeasurement:"",useNum:"",company:""}},mounted(){this.getAgriculturalUser(),this.getAgriculturalCategory(),this.getUnitMeasurement();let e=["createTask","createNongshi"];e.includes(this.from)&&(this.showTab2=!1)},methods:{inputNum(e){this.$message.warning("库存不足"),this.list[e].useNum=""},chose(){let e=[],t=null;"no"!=this.neednum&&(this.list.map((a=>{a.use&&(a.useNum?e.push(a):t=a)})),t)?this.$message.warning(`请输入[${t.agriculturalBo.title}]的使用数量`):("no"==this.neednum&&this.list.map((t=>{t.use&&e.push(t)})),e=e.map((e=>({agriculturalType:e.agriculturalBo.agriculturalCategory,agricultural:e.agriculturalBo.title,agriculturalId:e.agriculturalBo.id,agriculturalCount:e.useNum,agriculturalUnit:e.agriculturalBo.unitweight,definition:0,agriculturalUnitId:e.agriculturalBo.unitweightid,isUse:0,manufacturers:e.agriculturalBo.manufacturers}))),console.log(e),this.$emit("chose",e),this.onClose())},save(e){let t={agricultural:this.title,agriculturalId:"",agriculturalCount:this.useNum,agriculturalUnit:"",definition:1,agriculturalUnitId:this.currentUnitMeasurement,isUse:0,manufacturers:this.company};this.unitMeasurement.map((e=>{e.id==this.currentUnitMeasurement&&(t.agriculturalUnit=e.title)})),t.agricultural?this.currentAgriculturalCategory?-1!=this.currentAgriculturalCategory||this.diyAgriculturalCategory?t.agriculturalCount?(-1==this.currentAgriculturalCategory?(t.agriculturalType=this.diyAgriculturalCategory,t.id=""):(t.id=this.currentAgriculturalCategory,this.agriculturalCategory.map((e=>{e.id==t.id&&(t.agriculturalType=e.title)}))),this.$emit("save",t),1==e?this.onClose():(this.title="",this.currentAgriculturalCategory="",this.useNum="",this.company="")):this.$message.warning("请输入使用量"):this.$message.warning("请输入农资类型"):this.$message.warning("请选择农资类型"):this.$message.warning("请输入农资标题")},onClose(e=null){"function"==typeof e&&(e=null),this.$emit("close",e),this.showDetailBox=!1},getUnitMeasurement(){this.ajax.post("/api/v1/adam/farm/getWeightUnit").then((e=>{this.unitMeasurement=e.data,this.currentUnitMeasurement=e.data[0].id}))},getAgriculturalCategory(){this.ajax.post("/api/v1/adam/farm/getAgriculturalCategory").then((e=>{this.agriculturalCategory=e.data,this.agriculturalCategory.unshift({id:-1,title:"自定义"})}))},getAgriculturalUser(){let e="createTask"==this.from?"/api/v1/adam/farmLand/agriculturalSearch-list":"/api/v1/adam/farmLand/agriculturalUser-list";this.ajax.post(e,{pageNum:1,pageSize:100,param:{endTime:"",id:0,keyWord:"",startTime:""}}).then((e=>{this.list=e.data.map((e=>(this.selected&&this.selected.map((t=>{e.agriculturalBo.id==t.agriculturalId&&(e.selected=!0,e.useNum=t.agriculturalCount,e.use=!0)})),e)))}))}}},W=a(8118);const M=(0,W.Z)(P,[["render",A],["__scopeId","data-v-6fae29c1"]]);var F=M},5626:function(e,t,a){a.d(t,{Z:function(){return Ge}});var l=a(6252),i=a(3577);const s=e=>((0,l.dD)("data-v-43652642"),e=e(),(0,l.Cn)(),e),r={class:"btn"},o={class:"form"},n={class:"item"},u=s((()=>(0,l._)("p",{class:"title"},"种植植物：",-1))),d={class:"content"},m={class:"text"},c={class:"item"},p=s((()=>(0,l._)("p",{class:"title"},"农事类型：",-1))),g={class:"content",style:{display:"flex"}},h={key:0,class:"item",style:{"margin-top":"5px"}},w=s((()=>(0,l._)("p",{class:"title"},null,-1))),f={class:"content nz"},y={class:"tag"},v=s((()=>(0,l._)("span",null,"虫子",-1))),k=["onClick"],_={class:"tag"},D=s((()=>(0,l._)("span",null,"天敌",-1))),C=["onClick"],B=s((()=>(0,l._)("i",{class:"erp erpicon_tianjia"},null,-1))),b=(0,l.Uk)(" 添加虫子 "),U=[B,b],V=s((()=>(0,l._)("i",{class:"erp erpicon_tianjia"},null,-1))),x=(0,l.Uk)(" 添加天敌 "),T=[V,x],L={key:1,class:"item",style:{"margin-top":"5px"}},$=s((()=>(0,l._)("p",{class:"title"},null,-1))),z={class:"content nz"},I={class:"nzItem"},N={key:0,class:"nzBox",style:{width:"438px"}},j={key:1,class:"nzBox"},q=(0,l.Uk)("厘米"),E=(0,l.Uk)("个"),A={key:2,class:"item"},P=s((()=>(0,l._)("p",{class:"title"},"采摘重量：",-1))),W={class:"content"},M=(0,l.Uk)("公斤"),F={class:"item"},H=s((()=>(0,l._)("p",{class:"title"},"使用农资：",-1))),S={key:0,class:"content"},G=s((()=>(0,l._)("p",{class:"text"},"暂无数据",-1))),K=[G],Y={key:1,class:"content nz"},Z={class:"tag"},O=["onClick"],R=s((()=>(0,l._)("i",{class:"erp erpicon_tianjia"},null,-1))),J=(0,l.Uk)(" 添加农资 "),Q=[R,J],X={class:"item"},ee=s((()=>(0,l._)("p",{class:"title"},"工时：",-1))),te={class:"content"},ae={class:"item"},le=s((()=>(0,l._)("p",{class:"title"},"作业方式：",-1))),ie={class:"content"},se={class:"item"},re=s((()=>(0,l._)("p",{class:"title"},"操作时间：",-1))),oe={class:"content"},ne={class:"item"},ue=s((()=>(0,l._)("p",{class:"title"},"操作人：",-1))),de={class:"content"},me={class:"item"},ce=s((()=>(0,l._)("p",{class:"title"},"农事照片：",-1))),pe={key:0,class:"content"},ge=["onClick","src"],he={key:0,class:"text"},we={key:1,class:"content"},fe={class:"pics"},ye=["src"],ve=["onClick"],ke={key:0,class:"upload"},_e={key:1},De=s((()=>(0,l._)("i",{class:"erp erpshangchuan"},null,-1))),Ce=[De],Be={key:2},be={class:"item itemBig"},Ue=s((()=>(0,l._)("p",{class:"title"},"备注：",-1))),Ve={class:"content"},xe={class:"item itemBig"},Te=s((()=>(0,l._)("p",{class:"title"},"环境数据：",-1))),Le={class:"content hj",style:{width:"460px"}},$e=["src"],ze={key:0,class:"text"},Ie={class:"item itemBig"},Ne=s((()=>(0,l._)("p",{class:"title"},"现场照片：",-1))),je={class:"content hj",style:{width:"460px"}},qe=s((()=>(0,l._)("p",{class:"text"},"暂无数据",-1)));function Ee(e,t,a,s,B,b){const V=(0,l.up)("el-button"),x=(0,l.up)("el-option"),G=(0,l.up)("el-select"),R=(0,l.up)("el-input"),J=(0,l.up)("el-date-picker"),De=(0,l.up)("el-progress"),Ee=(0,l.up)("PlantCropsDetailBDialogChose"),Ae=(0,l.up)("PlantCropsDetailBDialogAddPests"),Pe=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.j4)(Pe,{modelValue:B.dialogVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>B.dialogVisible=e),title:a.title,width:"580px","before-close":b.handleClose,"append-to-body":""},{default:(0,l.w5)((()=>[(0,l._)("div",r,[e.$store.state.power.editFarmRecordBtn?((0,l.wg)(),(0,l.j4)(V,{key:0,type:"primary",onClick:b.editButton},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(B.isEdit?"保存":"编辑"),1)])),_:1},8,["onClick"])):(0,l.kq)("",!0),e.$store.state.power.delFarmRecordBtn?((0,l.wg)(),(0,l.j4)(V,{key:1,type:"primary",plain:"",onClick:b.del},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(B.isEdit?"取消":"删除"),1)])),_:1},8,["onClick"])):(0,l.kq)("",!0)]),(0,l._)("div",o,[(0,l._)("div",n,[u,(0,l._)("div",d,[(0,l._)("p",m,(0,i.zw)(B.form.categoryTitle+"-"+B.form.address),1)])]),(0,l._)("div",c,[p,(0,l._)("div",g,[(0,l.Wm)(G,{disabled:!B.isEdit,style:{width:"100%"},modelValue:B.form.farmId,"onUpdate:modelValue":t[0]||(t[0]=e=>B.form.farmId=e),placeholder:"请选择农事类型"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.farmType,(e=>((0,l.wg)(),(0,l.j4)(x,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"]),15==B.form.farmId?((0,l.wg)(),(0,l.j4)(R,{key:0,style:{width:"140px","margin-left":"10px"},modelValue:B.form.title,"onUpdate:modelValue":t[1]||(t[1]=e=>B.form.title=e),placeholder:"请输入"},null,8,["modelValue"])):(0,l.kq)("",!0)])]),16==B.form.farmId?((0,l.wg)(),(0,l.iD)("div",h,[w,(0,l._)("div",f,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.form.farmDetailBo.farmDetailListChongBoList,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"nzItem",key:e.id},[(0,l._)("div",{class:"nzBox",style:(0,i.j5)({width:B.isEdit?"400px":"438px"})},[(0,l._)("span",null,[(0,l._)("span",y,(0,i.zw)(e.title),1)]),v,(0,l._)("span",null,(0,i.zw)(e.count)+"只",1)],4),B.isEdit?((0,l.wg)(),(0,l.iD)("i",{key:0,class:"erp erpshanchu",onClick:e=>b.removePests(t,1)},null,8,k)):(0,l.kq)("",!0)])))),128)),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.form.farmDetailBo.farmDetailListTianBoList,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"nzItem",key:e.id},[(0,l._)("div",{class:"nzBox",style:(0,i.j5)({width:B.isEdit?"400px":"438px"})},[(0,l._)("span",null,[(0,l._)("span",_,(0,i.zw)(e.title),1)]),D,(0,l._)("span",null,(0,i.zw)(e.count)+"只",1)],4),B.isEdit?((0,l.wg)(),(0,l.iD)("i",{key:0,class:"erp erpshanchu",onClick:e=>b.removePests(t,0)},null,8,C)):(0,l.kq)("",!0)])))),128)),B.isEdit&&"采摘"!=B.form.title?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"nzAdd",onClick:t[2]||(t[2]=e=>b.addPests(1))},U)):(0,l.kq)("",!0),B.isEdit&&"采摘"!=B.form.title?((0,l.wg)(),(0,l.iD)("div",{key:1,class:"nzAdd",style:{"border-top":"1px solid rgba(0, 0, 0, 0.05)"},onClick:t[3]||(t[3]=e=>b.addPests(0))},T)):(0,l.kq)("",!0)])])):(0,l.kq)("",!0),17==B.form.farmId?((0,l.wg)(),(0,l.iD)("div",L,[$,(0,l._)("div",z,[(0,l._)("div",I,[B.isEdit?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",N,[(0,l._)("span",null,"观测点："+(0,i.zw)(B.form.farmDetailBo.title),1),(0,l._)("span",null,(0,i.zw)(B.form.farmDetailBo.farmDetailListGrowBoList[0].title)+"厘米",1),(0,l._)("span",null,(0,i.zw)(B.form.farmDetailBo.farmDetailListGrowBoList[0].count)+"个节点",1)])),B.isEdit?((0,l.wg)(),(0,l.iD)("div",j,[(0,l.Wm)(R,{modelValue:B.form.farmDetailBo.title,"onUpdate:modelValue":t[4]||(t[4]=e=>B.form.farmDetailBo.title=e),placeholder:"监测点",style:{width:"35%"}},null,8,["modelValue"]),(0,l.Wm)(R,{style:{width:"35%"},modelValue:B.form.farmDetailBo.farmDetailListGrowBoList[0].title,"onUpdate:modelValue":t[5]||(t[5]=e=>B.form.farmDetailBo.farmDetailListGrowBoList[0].title=e),placeholder:"株高"},{append:(0,l.w5)((()=>[q])),_:1},8,["modelValue"]),(0,l.Wm)(R,{style:{width:"30%"},modelValue:B.form.farmDetailBo.farmDetailListGrowBoList[0].count,"onUpdate:modelValue":t[6]||(t[6]=e=>B.form.farmDetailBo.farmDetailListGrowBoList[0].count=e),placeholder:"节点数"},{append:(0,l.w5)((()=>[E])),_:1},8,["modelValue"])])):(0,l.kq)("",!0)])])])):(0,l.kq)("",!0),13==B.form.farmId?((0,l.wg)(),(0,l.iD)("div",A,[P,(0,l._)("div",W,[(0,l.Wm)(R,{disabled:!B.isEdit,modelValue:B.form.pickCount,"onUpdate:modelValue":t[7]||(t[7]=e=>B.form.pickCount=e),placeholder:"输入采摘重量"},{append:(0,l.w5)((()=>[M])),_:1},8,["disabled","modelValue"])])])):(0,l.kq)("",!0),(0,l._)("div",F,[H,0!=B.form.farmUseBos.length||B.isEdit?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",S,K)),B.form.farmUseBos.length>0||B.isEdit?((0,l.wg)(),(0,l.iD)("div",Y,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.form.farmUseBos,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"nzItem",key:e.id},[(0,l._)("div",{class:"nzBox",style:(0,i.j5)({width:B.isEdit?"400px":"438px"})},[(0,l._)("span",null,[(0,l._)("span",Z,(0,i.zw)(e.agriculturalType),1)]),(0,l._)("span",null,(0,i.zw)(e.agricultural),1),(0,l._)("span",null,(0,i.zw)(e.agriculturalCount)+(0,i.zw)(e.agriculturalUnit),1)],4),B.isEdit?((0,l.wg)(),(0,l.iD)("i",{key:0,class:"erp erpshanchu",onClick:e=>b.removeNz(t)},null,8,O)):(0,l.kq)("",!0)])))),128)),B.isEdit?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"nzAdd",onClick:t[8]||(t[8]=e=>B.showChose=!0)},Q)):(0,l.kq)("",!0)])):(0,l.kq)("",!0)]),(0,l._)("div",X,[ee,(0,l._)("div",te,[(0,l.Wm)(R,{disabled:!B.isEdit,modelValue:B.form.workHour,"onUpdate:modelValue":t[9]||(t[9]=e=>B.form.workHour=e),placeholder:"请输入工时"},null,8,["disabled","modelValue"])])]),(0,l._)("div",ae,[le,(0,l._)("div",ie,[(0,l.Wm)(G,{disabled:!B.isEdit,style:{width:"100%"},modelValue:B.form.workType,"onUpdate:modelValue":t[10]||(t[10]=e=>B.form.workType=e),placeholder:"请选择作业方式"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.operatingType,(e=>((0,l.wg)(),(0,l.j4)(x,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])]),(0,l._)("div",se,[re,(0,l._)("div",oe,[(0,l.Wm)(J,{disabled:!B.isEdit,style:{width:"100%"},modelValue:B.form.workTime,"onUpdate:modelValue":t[11]||(t[11]=e=>B.form.workTime=e),type:"date",placeholder:"请选择操作时间"},null,8,["disabled","modelValue"])])]),(0,l._)("div",ne,[ue,(0,l._)("div",de,[(0,l.Wm)(R,{disabled:!B.isEdit,modelValue:B.form.userName,"onUpdate:modelValue":t[12]||(t[12]=e=>B.form.userName=e),placeholder:"请输入操作人"},null,8,["disabled","modelValue"])])]),(0,l._)("div",me,[ce,B.isEdit?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",pe,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.form.image,((e,t)=>((0,l.wg)(),(0,l.iD)("img",{class:"picsimg",onClick:t=>b.viewImg(e),key:t,src:e,alt:""},null,8,ge)))),128)),0==B.form.image.length?((0,l.wg)(),(0,l.iD)("p",he,"暂无数据")):(0,l.kq)("",!0)])),B.isEdit?((0,l.wg)(),(0,l.iD)("div",we,[(0,l._)("div",fe,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.form.image,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"img",key:t},[(0,l._)("img",{src:e,alt:""},null,8,ye),(0,l._)("i",{class:"erp erpguanbi",onClick:e=>b.removeImg(t)},null,8,ve)])))),128)),B.form.image.length<2?((0,l.wg)(),(0,l.iD)("div",ke,[B.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("input",{key:0,onChange:t[13]||(t[13]=(...e)=>b.uploadFile&&b.uploadFile(...e)),ref:"file",type:"file"},null,544)),B.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",_e,Ce)),B.uploading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("p",Be,"点击上传照片")),B.uploading?((0,l.wg)(),(0,l.j4)(De,{key:3,width:90,type:"circle",percentage:B.percentage},null,8,["percentage"])):(0,l.kq)("",!0)])):(0,l.kq)("",!0)])])):(0,l.kq)("",!0)]),(0,l._)("div",be,[Ue,(0,l._)("div",Ve,[(0,l.Wm)(R,{disabled:!B.isEdit,modelValue:B.form.workText,"onUpdate:modelValue":t[14]||(t[14]=e=>B.form.workText=e),placeholder:"请输入备注"},null,8,["disabled","modelValue"])])]),(0,l._)("div",xe,[Te,(0,l._)("div",Le,[(0,l._)("div",{class:"hjbox",style:(0,i.j5)({width:150*B.form.smartDevice.length+"px"})},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(B.form.smartDevice,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"huanjing",key:e.id},[(0,l._)("img",{src:b.getIconUrl(e.icon),alt:""},null,8,$e),(0,l._)("p",null,(0,i.zw)(e.value||" ")+(0,i.zw)(e.unit||" "),1),(0,l._)("p",null,(0,i.zw)(e.displayName),1)])))),128))],4),0==B.form.smartDevice.length?((0,l.wg)(),(0,l.iD)("p",ze,"暂无数据")):(0,l.kq)("",!0)])]),(0,l._)("div",Ie,[Ne,(0,l._)("div",je,[(0,l.kq)("",!0),qe])])]),B.showChose?((0,l.wg)(),(0,l.j4)(Ee,{key:0,onSave:b.save,onChose:b.chose,onClose:b.closeChose},null,8,["onSave","onChose","onClose"])):(0,l.kq)("",!0),B.showAddPests?((0,l.wg)(),(0,l.j4)(Ae,{key:1,type:B.addPestsType,onClose:b.closePests,onSave:b.savePests},null,8,["type","onClose","onSave"])):(0,l.kq)("",!0)])),_:1},8,["modelValue","title","before-close"])}var Ae=a(3483),Pe=a(7702),We=a(7987),Me=a(2335),Fe={props:["title","id"],emits:["load","success","close"],data(){return{dialogVisible:!0,searchKey:"",list:[],imgs:[],form:{image:[],farmUseBos:[],smartDevice:[]},farmType:[],operatingType:[],isEdit:!1,uploading:!1,percentage:0,showChose:!1,showAddPests:!1,addPestsType:0}},components:{PlantCropsDetailBDialogChose:Pe.Z,PlantCropsDetailBDialogAddPests:We.Z},mounted(){let e=this,t=async function(){await e.getData(),await e.getFarmType(),await e.getOperatingType(),await e.getFarmRecordImg()};t()},computed:{imgSpace(){let e=0;return e=4-this.imgs.length%4,e}},methods:{saveGrowData(){this.isEdit=!1},addPests(e){this.showAddPests=!0,this.addPestsType=e},savePests(e){e.type?this.form.farmDetailBo.farmDetailListChongBoList.push({count:e.num,farmDetailId:0,title:e.name,type:0}):this.form.farmDetailBo.farmDetailListTianBoList.push({count:e.num,farmDetailId:0,title:e.name,type:1})},closePests(){let e=setTimeout((()=>{this.showAddPests=!1,clearTimeout(e)}),500)},removePests(e,t){1==t?this.form.farmDetailBo.farmDetailListChongBoList.splice(e,1):this.form.farmDetailBo.farmDetailListTianBoList.splice(e,1)},viewImg(e){this.$nextTick((()=>{window.open(e)}))},getFarmRecordImg(){this.ajax.post("/api/v1/adam/task/getFarmRecordImg",{growPlantId:this.$route.query.id}).then((e=>{let t=[];e.data.images.map((a=>{t.push({url:a.image,time:Me.Z.time(a.createTime),gardenTitle:e.data.gardenTitle,address:e.data.address})})),this.imgs=t}))},editButton(){if(this.isEdit){let e=JSON.parse(JSON.stringify(this.form));e.smartDevice=JSON.stringify(e.smartDevice),e.image=e.image.join(","),e.farmDetailBo&&(16==e.farmId&&(e.farmDetailBo.farmType=0),17==e.farmId&&(e.farmDetailBo.farmType=1)),this.ajax.post("/api/v1/adam/farm/editeFarm",e).then((e=>{200==e.code?(this.$message.success("保存成功"),this.isEdit=!1,this.$emit("load")):this.$message.error(e.message)}))}else this.isEdit=!0},closeChose(){setTimeout((()=>{this.showChose=!1}),300)},removeNz(e){this.form.farmUseBos.splice(e,1)},getIconUrl(e){return`https://cdn.deepberry.cn/img/common/node-props/${e||"default"}.svg`},chose(e){console.log(e);let t=[...this.form.farmUseBos,...e].map((e=>(e.agriculturalCount=Number(e.agriculturalCount),e)));var a=function(e){for(var t=[],a=[],l=0;l<e.length;l++)a.indexOf(e[l].agricultural)>-1?t[a.indexOf(e[l].agricultural)].agriculturalCount+=e[l].agriculturalCount:(a.push(e[l].agricultural),t.push(e[l]));return t};this.form.farmUseBos=a(t)},save(e){this.form.farmUseBos.push(e)},removeImg(e){console.log(e),this.form.image.splice(e,1)},uploadFile(){this.uploading=!0;let e=this.$refs.file.files[0];(0,Ae.Z)(e,`erp/farmingHistory/${e.name}`).then((e=>{e.url&&(this.form.image.push(e.url),this.uploading=!1,this.percentage=0)}))},del(){this.isEdit?(this.isEdit=!1,this.getData()):this.ajax.post("/api/v1/adam/farm/delFarmRecordById",{id:this.id}).then((e=>{200==e.code?(this.$message.success("删除成功"),this.handleClose(),this.$emit("load")):this.$message.error(e.message)}))},handleClose(){this.dialogVisible=!1,this.$emit("close")},getData(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getFarmRecordById",{id:this.id}).then((t=>{t.data.image=t.data.image.length>0?t.data.image.split(","):[],t.data.smartDevice=JSON.parse(t.data.smartDevice)||[],t.data.farmDetailBo=t.data.farmDetailBo||{farmDetailListChongBoList:[],farmDetailListTianBoList:[],farmDetailListGrowBoList:[]},t.data.farmDetailBo.farmDetailListGrowBoList=t.data.farmDetailBo.farmDetailListGrowBoList||[],t.data.farmDetailBo.farmDetailListGrowBoList=t.data.farmDetailBo.farmDetailListGrowBoList.length?t.data.farmDetailBo.farmDetailListGrowBoList:[{}],this.form=t.data,e()}))}))},getFarmType(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getFarmType").then((t=>{this.farmType=t.data,e()}))}))},getOperatingType(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getOperatingType").then((t=>{this.operatingType=t.data,e()}))}))}}},He=a(8118);const Se=(0,He.Z)(Fe,[["render",Ee],["__scopeId","data-v-43652642"]]);var Ge=Se},2335:function(e,t){const a={to2:e=>Number(e)<10?`0${Number(e)}`:String(e),time(e="y-m-d",t=null){let a=t?new Date(t):new Date;return e=e.replace("y",a.getFullYear()),e=e.replace("m",this.to2(a.getMonth()+1)),e=e.replace("d",this.to2(a.getDate())),e=e.replace("h",this.to2(a.getHours())),e=e.replace("i",this.to2(a.getMinutes())),e=e.replace("s",this.to2(a.getSeconds())),e=e.replace("w",a.getDay()),e},monthLength(e=null){let t=1*this.time("y",e),a=this.to2(1*this.time("m",e)+1);if(13==a)return 31;{let e=new Date(`${t}-${a}-01`).getTime()-864e5;return Number(this.time("d",e))}},preMonthLenggth(e=null){let t=1*this.time("y",e),a=this.to2(1*this.time("m",e)),l=new Date(`${t}-${a}-01`).getTime()-864e5;return Number(this.time("d",l))},nextMonthLenggth(e=null){let t=1*this.time("y",e),a=this.to2(1*this.time("m",e)+2),l=new Date(`${t}-${a}-01`).getTime()-864e5;return Number(this.time("d",l))},monthFirst(e=null){let t=this.time("y-m",e)+"-01";return this.time("y-m-d",t)},monthLast(e=null){let t=1*this.time("y",e),a=this.to2(1*this.time("m",e)+1),l=new Date(`${t}-${a}-01`).getTime()-864e5;return this.time("y-m-d",l)},preMonthToday(e=null){let t=Number(e.substr(0,4)),a=Number(e.substr(5,2)),l=Number(e.substr(8));return l>this.preMonthLenggth(`{y}-${a}-01`)&&(l=this.preMonthLenggth(`{y}-${a}-01`)),1==a?(t-=1,a=12):a-=1,`${t}-${a}-${l}`},nextMonthToday(e=null){let t=Number(e.substr(0,4)),a=Number(e.substr(5,2)),l=Number(e.substr(8));return l>this.nextMonthLenggth(`{y}-${a}-01`)&&(l=this.nextMonthLenggth(`{y}-${a}-01`)),12==a?(t+=1,a=1):a+=1,`${t}-${a}-${l}`},timeout(e){},timeRemaining(e,t){return t-=parseInt((new Date).getTime()/1e3),this.unixToString(e,t)},unixToString(e,t){let l=parseInt(t/60/60/24),i=parseInt((t-86400*l)/3600),s=parseInt((t-86400*l-3600*i)/60),r=t-86400*l-3600*i-60*s;return e=e.replace("d",a.to2(a.low(l))),e=e.replace("h",a.to2(a.low(i))),e=e.replace("i",a.to2(a.low(s))),e=e.replace("s",a.to2(a.low(r))),e},low(e){return e<0?0:e},parse(e){return new Date(e)}};t["Z"]=a}}]);
//# sourceMappingURL=626.5bbcf7f8.js.map