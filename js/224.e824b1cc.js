"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[224],{4274:function(t,a,e){e.d(a,{Z:function(){return b}});var l=e(6252),r=e(3577);const i=t=>((0,l.dD)("data-v-09ed84dc"),t=t(),(0,l.Cn)(),t),o={class:"purchaseDetailBox"},u={class:"purchaseDetailBoxInner"},s=(0,l.Uk)("删除"),n={class:"bottom"},c=i((()=>(0,l._)("div",null,"合计：",-1))),d=i((()=>(0,l._)("span",null,"总价",-1))),p={class:"buttons"},g=(0,l.Uk)("联系客服"),h=(0,l.Uk)("提交订单");function m(t,a,e,i,m,w){const C=(0,l.up)("el-table-column"),f=(0,l.up)("el-input"),v=(0,l.up)("el-button"),b=(0,l.up)("el-table"),k=(0,l.up)("el-dialog"),B=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",o,[(0,l.Wm)(k,{"custom-class":"purchaseDetailBox","before-close":w.onClose,"append-to-body":"",modelValue:m.showCarBox,"onUpdate:modelValue":a[0]||(a[0]=t=>m.showCarBox=t),title:"购物车",width:"900px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",u,[(0,l.Wm)(b,{size:"large",ref:"table",onSelect:w.select,onSelectAll:w.select,data:m.list,style:{width:"100%"}},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{type:"selection",width:"40"}),(0,l.Wm)(C,{prop:"agriculturalBo.title",label:"农资名称","show-overflow-tooltip":""}),(0,l.Wm)(C,{prop:"agriculturalBo.agriculturalCategory",label:"农资类型","show-overflow-tooltip":""}),(0,l.Wm)(C,{prop:"agriculturalBo.manufacturers",label:"生产厂家","show-overflow-tooltip":""}),(0,l.Wm)(C,{label:"规格",width:"140"},{default:(0,l.w5)((t=>[(0,l.Uk)(" ("+(0,r.zw)(t.row.agriculturalBo.agriculturalCount+t.row.agriculturalBo.unitweight+"/"+t.row.agriculturalBo.unitmeasurement)+") ",1)])),_:1}),(0,l.Wm)(C,{width:"120",label:"价格","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)(" ￥"+(0,r.zw)(t.row.agriculturalBo.agriculturalPrice),1)])),_:1}),(0,l.Wm)(C,{width:"120",label:"数量","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Wm)(f,{type:"number",modelValue:t.row.unit,"onUpdate:modelValue":a=>t.row.unit=a,style:{width:"60px"},size:"small",placeholder:"数量",onBlur:a=>w.resetCarCount(t.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),(0,l.Uk)(" "+(0,r.zw)(t.row.agriculturalBo.unitmeasurement),1)])),_:1}),(0,l.Wm)(C,{width:"120",label:"操作","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Wm)(v,{size:"small",type:"primary",onClick:a=>w.remove(t)},{default:(0,l.w5)((()=>[s])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["onSelect","onSelectAll","data"]),(0,l._)("div",n,[c,(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(m.totalList,(t=>((0,l.wg)(),(0,l.iD)("p",{key:t.title},[(0,l._)("span",null,(0,r.zw)(t.title),1),(0,l._)("span",null,(0,r.zw)(t.num)+(0,r.zw)(t.unit),1)])))),128)),(0,l._)("p",null,[d,(0,l._)("span",null,"￥"+(0,r.zw)(w.allPrice)+".00元",1)])])]),(0,l._)("div",p,[(0,l.Wm)(v,{type:"primary",round:"",plain:"",onClick:w.showServer},{default:(0,l.w5)((()=>[g])),_:1},8,["onClick"]),t.$store.state.power.submitShoppingOrderBtn?((0,l.wg)(),(0,l.j4)(v,{key:0,type:"primary",onClick:w.submit,loading:m.submitting},{default:(0,l.w5)((()=>[h])),_:1},8,["onClick","loading"])):(0,l.kq)("",!0)])])),[[B,m.carLoading]])])),_:1},8,["before-close","modelValue"])])}var w={total(t,a){let e=t.map((t=>this.findAttr(t,a))),l=Array.from(new Set(e)),r=l.map((e=>{let l={title:e,num:0};return t.map((t=>{this.findAttr(t,a)==e&&(l.num+=t.agriculturalBo.agriculturalCount*t.unit)})),l}));return r},findAttr(t,a){let e=a.split("."),l=JSON.parse(JSON.stringify(e));return l.map((a=>{t=t[e[0]],e.shift()})),t}},C={name:"purchaseOrderCar",props:["id"],data(){return{list:[],selected:[],showCarBox:!0,detail:{},carLoading:!1,totalList:[],submitting:!1}},computed:{allPrice(){let t=0;return this.selected.map((a=>{t+=a.agriculturalBo.agriculturalPrice*a.unit})),t}},watch:{allPrice(){this.totalList=w.total(this.selected,"agriculturalBo.title"),this.totalList=this.totalList.map((t=>(this.list.map((a=>{a.agriculturalBo.title==t.title&&(t.unit=a.agriculturalBo.unitweight)})),t)))}},mounted(){this.getCar()},methods:{remove(t){let a=t.$index,e=t.row.id;this.ajax.post("/api/v1/adam/agricultural/cart-del",{id:e}).then((t=>{this.list.splice(a,1)}))},select(t){console.log(t),this.selected=t},getCar(){this.carLoading=!0,this.ajax.post("/api/v1/adam/agricultural/cart",{pageNum:0,pageSize:0,param:{keyWord:"",orderStatus:0}}).then((t=>{let a=[];t.data.map((t=>{t.unit>0&&a.push(t)})),this.list=a,this.carLoading=!1}))},onClose(){this.$emit("closeCarBox",0),this.showCarBox=!1},showServer(){this.$alert("客服电话：13606870818","联系客服")},resetCarCount(t){this.ajax.post("/api/v1/adam/agricultural/cart-update",{agriculturalId:t.agriculturalBo.id,id:t.id,unit:t.unit})},submit(){let t=this;if(0==t.$refs.table.getSelectionRows().length)return void t.$message.warning("请选择农资");let a=[],e=t.$refs.table.getSelectionRows().map((t=>(a.push({agriculturalCos:t.agriculturalBo.agriculturalCount*t.agriculturalBo.agriculturalPrice,id:t.agriculturalBo.agriculturalCategoryId,title:t.agriculturalBo.title,unitweight:t.agriculturalBo.agriculturalCount}),{agriculturalId:t.agriculturalBo.id,id:t.id,unit:t.unit})));t.submitting=!0,t.ajax.post("/api/v1/adam/agricultural/saveOrder",{orderCartBoList:e,orderCos:t.allPrice,totalCount:a}).then((a=>{t.submitting=!1,200==a.code?(t.$message.success("提交成功"),t.onClose()):t.$message.error(a.message)}))}}},f=e(8118);const v=(0,f.Z)(C,[["render",m],["__scopeId","data-v-09ed84dc"]]);var b=v},7224:function(t,a,e){e.r(a),e.d(a,{default:function(){return y}});var l=e(6252),r=e(3577);const i=t=>((0,l.dD)("data-v-47e94960"),t=t(),(0,l.Cn)(),t),o={class:"purchaseOrder"},u={class:"ctrl"},s={class:"search"},n=(0,l.Uk)("查询"),c=i((()=>(0,l._)("i",{class:"erp erpgouwuche"},null,-1))),d=(0,l.Uk)(" 购物车"),p={class:"tableWrap"},g={class:"table"},h={style:{color:"rgba(224, 29, 29, 1)"}},m=(0,l.Uk)("查看详情"),w={key:0,class:"pages"},C={class:"total"};function f(t,a){const e=(0,l.up)("el-input"),i=(0,l.up)("el-button"),f=(0,l.up)("el-badge"),v=(0,l.up)("el-table-column"),b=(0,l.up)("el-table"),k=(0,l.up)("el-pagination"),B=(0,l.up)("PurchaseCar"),y=(0,l.Q2)("loading");return(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",o,[(0,l._)("div",u,[(0,l._)("div",s,[(0,l._)("div",null,[(0,l.Wm)(e,{modelValue:t.searchKey,"onUpdate:modelValue":a[0]||(a[0]=a=>t.searchKey=a),class:"searchInput",placeholder:"关键词搜索：农资类型、农资名称、厂家名称"},null,8,["modelValue"]),(0,l.Wm)(i,{type:"primary",class:"searchSubmit",onClick:t.getData},{default:(0,l.w5)((()=>[n])),_:1},8,["onClick"])]),(0,l._)("div",null,[t.$store.state.power.shoppingCartBtn?((0,l.wg)(),(0,l.j4)(f,{key:0,value:t.carCount,class:"item",onClick:t.showCar},{default:(0,l.w5)((()=>[(0,l.Wm)(i,{type:"primary",class:"searchCreateNewTask",plain:""},{default:(0,l.w5)((()=>[c,d])),_:1})])),_:1},8,["value","onClick"])):(0,l.kq)("",!0)])])]),(0,l._)("div",p,[(0,l._)("div",g,[(0,l.Wm)(b,{size:"large",data:t.list,style:{width:"100%"},"max-height":"600px"},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{prop:"title",label:"农资名称","show-overflow-tooltip":""}),(0,l.Wm)(v,{prop:"agriculturalCategory",label:"农资类型"}),(0,l.Wm)(v,{label:"规格"},{default:(0,l.w5)((t=>[(0,l.Uk)((0,r.zw)(t.row.agriculturalCount+t.row.unitweight+"/"+t.row.unitmeasurement),1)])),_:1}),(0,l.Wm)(v,{prop:"manufacturers",label:"厂家","show-overflow-tooltip":""}),(0,l.Wm)(v,{label:"参考单价"},{default:(0,l.w5)((t=>[(0,l._)("span",h,"￥"+(0,r.zw)(t.row.agriculturalPrice),1)])),_:1}),(0,l.Wm)(v,{label:"操作",width:"180"},{default:(0,l.w5)((a=>[t.$store.state.power.materialsPurchaseDetail?((0,l.wg)(),(0,l.j4)(i,{key:0,link:"",type:"primary",onClick:e=>t.viewDetail(a.row.id)},{default:(0,l.w5)((()=>[m])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data"]),t.list.length>0?((0,l.wg)(),(0,l.iD)("div",w,[(0,l._)("span",C,"共 "+(0,r.zw)(t.total)+" 条",1),(0,l.Wm)(k,{currentPage:t.currentPage,"onUpdate:currentPage":a[1]||(a[1]=a=>t.currentPage=a),"page-size":t.pageSize,"onUpdate:page-size":a[2]||(a[2]=a=>t.pageSize=a),onCurrentChange:t.getData,background:"",layout:"prev, pager, next, jumper",total:t.total},null,8,["currentPage","page-size","onCurrentChange","total"])])):(0,l.kq)("",!0)])]),t.showCarBox?((0,l.wg)(),(0,l.j4)(B,{key:0,onCloseCarBox:t.closeCarBox},null,8,["onCloseCarBox"])):(0,l.kq)("",!0)])),[[y,t.loading]])}var v=e(4274),b={name:"purchaseOrder",components:{PurchaseCar:v.Z},data(){return{loading:!1,searchKey:"",carCount:0,list:[],currentPage:0,pageSize:0,total:0,showCarBox:!1}},mounted(){this.getData(),this.getCarCount()},methods:{getCarCount(){return new Promise(((t,a)=>{this.ajax.post("/api/v1/adam/agricultural/cart-count").then((a=>{this.carCount=a.data||"",t()}))}))},getData(){this.loading=!0,this.ajax.post("/api/v1/adam/agricultural/platform-list",{pageNum:this.currentPage,pageSize:10,param:{keyWord:this.searchKey,orderStatus:-1}}).then((t=>{console.log(t),this.list=t.data.map((t=>{let a="",e="";switch(t.orderStatus){case 0:a="已提交",e="#1890FF";break;case 1:a="已完成",e="#0DD71C";break;case 2:a="已关闭",e="#A8A8A8";break}return t.orderStatus=a,t.orderStatusColor=e,t})),this.currentPage=t.pageNum,this.pageSize=t.pageSize,this.total=t.total,this.loading=!1}))},viewDetail(t){this.$router.push({path:"/erp/purchase/shop/detail",query:{id:t}})},showCar(t){this.showCarBox=!0},closeCarBox(){let t=setTimeout((()=>{this.showCarBox=!1,clearTimeout(t)}),500)}}},k=e(8118);const B=(0,k.Z)(b,[["render",f],["__scopeId","data-v-47e94960"]]);var y=B}}]);
//# sourceMappingURL=224.e824b1cc.js.map