"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[213],{5213:function(t,e,a){a.r(e),a.d(e,{default:function(){return V}});var l=a(6252),r=a(3577);const o=t=>((0,l.dD)("data-v-5c1e02f4"),t=t(),(0,l.Cn)(),t),i={class:"workOrder inner"},s={class:"box"},u=o((()=>(0,l._)("div",{class:"head"},[(0,l._)("span",{class:"active"},"工单列表")],-1))),n={class:"ctrl"},d={class:"status"},c={class:"search"},w=(0,l.Uk)("查询"),p={class:"tableWrap"},h={class:"table"},g=o((()=>(0,l._)("br",null,null,-1))),k=o((()=>(0,l._)("br",null,null,-1))),m=o((()=>(0,l._)("br",null,null,-1))),D=(0,l.Uk)("查看详情"),v={key:0,class:"pages"},_={class:"total"};function f(t,e,a,o,f,y){const C=(0,l.up)("el-button"),b=(0,l.up)("el-badge"),B=(0,l.up)("el-input"),z=(0,l.up)("el-table-column"),x=(0,l.up)("el-table"),O=(0,l.up)("el-pagination"),S=(0,l.up)("WorkOrderDetail"),W=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l._)("div",s,[u,(0,l._)("div",n,[(0,l._)("div",d,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(f.status,(t=>((0,l.wg)(),(0,l.j4)(b,{class:"statusItem",value:t.sup>0?t.sup:"",onClick:e=>y.changeStatus(t),key:t.value},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{type:f.currentStatus==t.value?"primary":"",link:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,r.zw)(t.title),1)])),_:2},1032,["type"])])),_:2},1032,["value","onClick"])))),128))]),(0,l._)("div",c,[(0,l.Wm)(B,{modelValue:f.searchKey,"onUpdate:modelValue":e[0]||(e[0]=t=>f.searchKey=t),class:"searchInput",placeholder:"关键词搜索：农资类型、农资名称..."},null,8,["modelValue"]),(0,l.Wm)(C,{type:"primary",class:"searchSubmit",onClick:y.getData},{default:(0,l.w5)((()=>[w])),_:1},8,["onClick"])])]),(0,l._)("div",p,[(0,l._)("div",h,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(x,{size:"large",data:f.list,style:{width:"100%"},"max-height":"600px"},{default:(0,l.w5)((()=>[(0,l.Wm)(z,{prop:"orderUuid",label:"工单号","show-overflow-tooltip":""}),(0,l.Wm)(z,{label:"农资名称","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.row.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("span",{key:e},[(0,l.Uk)((0,r.zw)(t.variety)+" ",1),g])))),128))])),_:1}),(0,l.Wm)(z,{prop:"type",label:"农资类型"},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.row.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("span",{key:e},[(0,l.Uk)((0,r.zw)(t.title)+" ",1),k])))),128))])),_:1}),(0,l.Wm)(z,{prop:"num",label:"数量"},{default:(0,l.w5)((t=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(t.row.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("span",{key:e},[(0,l.Uk)((0,r.zw)(t.agriculturalCos)+" "+(0,r.zw)(t.unitweight)+" ",1),m])))),128))])),_:1}),(0,l.Wm)(z,{label:"状态"},{default:(0,l.w5)((t=>[(0,l._)("span",{style:(0,r.j5)({color:t.row.orderStatusColor})},(0,r.zw)(t.row.orderStatus),5)])),_:1}),(0,l.Wm)(z,{prop:"userName",label:"申领人"}),(0,l.Wm)(z,{label:"操作",width:"260"},{default:(0,l.w5)((e=>[t.$store.state.power.workOrderDetail?((0,l.wg)(),(0,l.j4)(C,{key:0,link:"",type:"primary",onClick:t=>y.showDetail(e.row.id)},{default:(0,l.w5)((()=>[D])),_:2},1032,["onClick"])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["data"])),[[W,f.loading]]),f.list.length>0?((0,l.wg)(),(0,l.iD)("div",v,[(0,l._)("span",_,"共 "+(0,r.zw)(f.total)+" 条",1),(0,l.Wm)(O,{currentPage:f.currentPage,"onUpdate:currentPage":e[1]||(e[1]=t=>f.currentPage=t),background:"",onCurrentChange:y.getData,layout:"prev, pager, next, jumper",total:f.total},null,8,["currentPage","onCurrentChange","total"])])):(0,l.kq)("",!0)])])]),f.showDetailBox?((0,l.wg)(),(0,l.j4)(S,{key:0,id:f.currentDetailId,onOnCloseDetail:y.onCloseDetail},null,8,["id","onOnCloseDetail"])):(0,l.kq)("",!0)])}const y=t=>((0,l.dD)("data-v-430e492f"),t=t(),(0,l.Cn)(),t),C={class:"workOrderDetail purchaseDetailBox"},b={class:"workOrderDetailInner purchaseDetailBoxInner"},B={class:"item"},z={class:"item"},x={class:"bottom"},O=y((()=>(0,l._)("div",null,"合计：",-1))),S=y((()=>(0,l._)("p",{style:{height:"0px"}},null,-1))),W={class:"form"},j=y((()=>(0,l._)("p",{class:"formTitle"},"审核流程",-1))),U={class:"formButton"},I=(0,l.Uk)("不通过"),K=(0,l.Uk)("通过"),N=(0,l.Uk)("一键出库");function P(t,e,a,o,i,s){const u=(0,l.up)("el-table-column"),n=(0,l.up)("el-table"),d=(0,l.up)("el-button"),c=(0,l.up)("el-dialog"),w=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",C,[(0,l.Wm)(c,{"custom-class":"workOrderDetail purchaseDetailBox","before-close":s.onClose,"append-to-body":"",modelValue:i.showDetailBox,"onUpdate:modelValue":e[3]||(e[3]=t=>i.showDetailBox=t),title:"工单详情",width:"1000px"},{default:(0,l.w5)((()=>[(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",b,[(0,l._)("div",B,[(0,l._)("p",null,"工单号："+(0,r.zw)(i.detail.orderNo),1),(0,l._)("p",{style:(0,r.j5)({color:i.detail.color})},(0,r.zw)(i.detail.status),5)]),(0,l._)("div",z,[(0,l._)("p",null,"提交人："+(0,r.zw)(i.detail.userName),1),(0,l._)("p",null,"提交时间："+(0,r.zw)(i.detail.orderTime),1)]),(0,l.Wm)(n,{size:"large",data:i.detail.agriculturalCartBos,style:{width:"100%","margin-top":"20px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{label:"农资名称",prop:"agriculturalBo.title","show-overflow-tooltip":""}),(0,l.Wm)(u,{label:"类型",width:"140",prop:"agriculturalBo.agriculturalCategory","show-overflow-tooltip":""}),(0,l.Wm)(u,{label:"规格",width:"140","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)((0,r.zw)(t.row.agriculturalBo.agriculturalCount)+" "+(0,r.zw)(t.row.agriculturalBo.unitweight)+"/"+(0,r.zw)(t.row.agriculturalBo.unitmeasurement),1)])),_:1}),(0,l.Wm)(u,{label:"厂家",prop:"agriculturalBo.manufacturers","show-overflow-tooltip":""}),(0,l.Wm)(u,{label:"申领数量","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)((0,r.zw)(t.row.agriculturalCos)+" "+(0,r.zw)(t.row.agriculturalBo.unitweight),1)])),_:1}),(0,l.Wm)(u,{label:"当前库存","show-overflow-tooltip":""},{default:(0,l.w5)((t=>[(0,l.Uk)((0,r.zw)(t.row.unit)+" "+(0,r.zw)(t.row.agriculturalBo.unitweight),1)])),_:1})])),_:1},8,["data"]),(0,l._)("div",x,[O,(0,l._)("div",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(i.detail.totalCount,((t,e)=>((0,l.wg)(),(0,l.iD)("p",{key:e},[(0,l._)("span",null,(0,r.zw)(t.title),1),(0,l._)("span",null,(0,r.zw)(t.agriculturalCos)+(0,r.zw)(t.unitweight),1)])))),128)),S])]),(0,l._)("div",W,[j,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(i.detail.orderManagerBoList,((t,e)=>((0,l.wg)(),(0,l.iD)("p",{key:e},[(0,l._)("span",null,(0,r.zw)(t.username),1),(0,l._)("span",{style:(0,r.j5)({color:t.color})},(0,r.zw)(t.check),5),(0,l._)("span",null,(0,r.zw)(t.checkTime),1)])))),128))]),(0,l._)("div",U,[t.$store.state.power.reviewOrderBtn&&1==i.detail.isCheckBth?((0,l.wg)(),(0,l.j4)(d,{key:0,type:"primary",onClick:e[0]||(e[0]=t=>s.check(2)),plain:""},{default:(0,l.w5)((()=>[I])),_:1})):(0,l.kq)("",!0),t.$store.state.power.reviewOrderBtn&&1==i.detail.isCheckBth?((0,l.wg)(),(0,l.j4)(d,{key:1,type:"primary",onClick:e[1]||(e[1]=t=>s.check(1))},{default:(0,l.w5)((()=>[K])),_:1})):(0,l.kq)("",!0),t.$store.state.power.simpleMaterialsOut&&1==i.detail.isOutBth?((0,l.wg)(),(0,l.j4)(d,{key:2,type:"primary",onClick:e[2]||(e[2]=t=>s.out(i.detail.id))},{default:(0,l.w5)((()=>[N])),_:1})):(0,l.kq)("",!0)])])),[[w,i.detailLoading]])])),_:1},8,["before-close","modelValue"])])}var L=a(9737),T={name:"workOrderDetail",props:["id"],data(){return{detailLoading:!1,showDetailBox:!0,detail:{}}},mounted(){this.getData()},methods:{out(t){let e=this.detail.agriculturalCartBos.map((t=>t.agriculturalBo.title));L.T.confirm("农资名称："+e.join(",")+" <br> 确定要出库吗？","一键出库",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((()=>{this.ajax.post("/api/v1/adam/farmLand/saveAgriculturalOutIn",{checkStatus:0,id:this.detail.id,orderNo:this.detail.orderNo}).then((t=>{200==t.code?(this.$message.success("出库成功"),this.onClose(1)):this.$message.error(t.message)}))})).catch((()=>{}))},check(t){this.ajax.post("/api/v1/adam/workOrder/checkOrder",{checkStatus:t,id:this.detail.id,orderNo:this.detail.orderNo}).then((t=>{this.onClose(1)}))},getData(){this.detailLoading=!0,this.ajax.post("/api/v1/adam/workOrder/workOrderDetail",{id:this.id}).then((t=>{if(200!=t.code)return this.$message.error(t.message),void(this.list=[]);JSON.parse(localStorage.getItem("erp_user")).id;switch(t.data.orderStatus){case 0:t.data.status="待审核",t.data.color="#EC2626";break;case 1:t.data.status="待出库",t.data.color="#0DD71C";break;case 2:t.data.status="不通过",t.data.color="#1890FF";break;case 3:t.data.status="已出库",t.data.color="#A8A8A8";break}t.data.orderManagerBoList=t.data.orderManagerBoList.map((t=>{switch(t.isCheck){case-1:t.check="发起人",t.color="#979797";break;case 0:t.check="待审核",t.color="#538DFF";break;case 1:t.check="通过",t.color="#3DC947";break;case 2:t.check="拒绝",t.color="#EC2D2D";break}return t})),this.detail=t.data,console.log(this.detail),this.detailLoading=!1}))},onClose(t){"function"==typeof t&&(t=null),this.$emit("onCloseDetail",t),this.showDetailBox=!1}}},$=a(8118);const A=(0,$.Z)(T,[["render",P],["__scopeId","data-v-430e492f"]]);var H=A,q={name:"workOrder",data(){return{status:[{title:"全部",value:"-1",sup:0},{title:"待审核",value:"0",sup:0},{title:"待出库",value:"1",sup:0},{title:"不通过",value:"2",sup:0},{title:"已出库",value:"3",sup:0}],currentStatus:"-1",searchKey:"",loading:!1,list:[],currentPage:1,pageSize:100,total:0,showDetailBox:!1,currentDetailId:""}},components:{WorkOrderDetail:H},mounted(){const t=async()=>{await this.getData(),await this.getStatus_0()};t()},methods:{getData(){return new Promise(((t,e)=>{this.loading=!0,this.ajax.post("/api/v1/adam/workOrder/workOrder-list",{pageNum:this.currentPage,pageSize:10,param:{keyWord:this.searchKey,orderStatus:this.currentStatus}}).then((e=>{this.loading=!1,this.list=e.data.map((t=>{let e="",a="";switch(t.orderStatus){case 0:e="待审核",a="#EC2626";break;case 1:e="待出库",a="#0DD71C";break;case 2:e="不通过",a="#1890FF";break;case 3:e="已出库",a="#A8A8A8";break}return t.orderStatus=e,t.orderStatusColor=a,t})),this.total=e.total,t()}))}))},getStatus_0(){return new Promise(((t,e)=>{this.ajax.post("/api/v1/adam/workOrder/workOrder-list",{pageNum:this.currentPage,pageSize:10,param:{keyWord:this.searchKey,orderStatus:0}}).then((e=>{this.status[1].sup=e.total,t()}))}))},changeStatus(t){this.currentStatus=t.value,this.getData()},showDetail(t){console.log(this.showDetailBox),this.currentDetailId=t,this.showDetailBox=!0},onCloseDetail(t){1==t&&this.getData();let e=setTimeout((()=>{this.showDetailBox=!1,clearTimeout(e)}),500)}}};const F=(0,$.Z)(q,[["render",f],["__scopeId","data-v-5c1e02f4"]]);var V=F}}]);
//# sourceMappingURL=213.ab3ea916.js.map