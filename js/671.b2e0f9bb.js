"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[671],{671:function(e,t,l){l.r(t),l.d(t,{default:function(){return Q}});var i=l(6252),a=l(3577),s=l(9963);const o=e=>((0,i.dD)("data-v-9890ecaa"),e=e(),(0,i.Cn)(),e),u={class:"stockPut inner"},n={class:"box"},r={class:"head"},d=o((()=>(0,i._)("i",{class:"erp erpfanhui",style:{"font-size":"14px","margin-right":"5px",position:"relative",top:"-1px"}},null,-1))),m=(0,i.Uk)(" 返回"),p=o((()=>(0,i._)("span",{style:{position:"relative",top:"2px","font-size":"15px"}},"农资入库",-1))),c={class:"content"},h={class:"info"},g={class:"tag"},w={class:"info"},f={style:{color:"#409eff"}},y=o((()=>(0,i._)("span",null,"入库数量：",-1))),k={key:0},b=o((()=>(0,i._)("i",{style:{"font-size":"12px","margin-right":"5px"},class:"erp erpicon_tianjia"},null,-1))),_=(0,i.Uk)(" 添加 "),v={class:"item log"},x=o((()=>(0,i._)("span",{class:"must"},"*",-1))),V=(0,i.Uk)(" 入库类型： "),U=o((()=>(0,i._)("span",{class:"must"},"*",-1))),W=(0,i.Uk)(" 入库时间： "),C=o((()=>(0,i._)("span",{class:"must"},"*",-1))),D=(0,i.Uk)(" 退回人： "),T={class:"item"},B=o((()=>(0,i._)("p",{class:"title"},[(0,i._)("span",{class:"must"},"*"),(0,i.Uk)(" 单据、凭证、照片：")],-1))),L={class:"pics"},I=["src"],$=["onClick"],z={key:0,class:"upload"},R={key:1},j=o((()=>(0,i._)("i",{class:"erp erpshangchuan"},null,-1))),S=[j],N={key:2},K={class:"item"},P=o((()=>(0,i._)("p",{class:"title"},"备注：",-1))),q={class:"item"},H=(0,i.Uk)("提交");function Y(e,t){const l=(0,i.up)("el-button"),o=(0,i.up)("el-input"),j=(0,i.up)("el-option"),Y=(0,i.up)("el-select"),O=(0,i.up)("el-date-picker"),A=(0,i.up)("el-progress"),F=(0,i.up)("StockReg"),Z=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",u,[(0,i._)("div",n,[(0,i._)("div",r,[(0,i.Wm)(l,{link:"",type:"primary",onClick:e.back},{default:(0,i.w5)((()=>[d,m])),_:1},8,["onClick"]),p]),(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",c,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.list,((t,s)=>((0,i.wg)(),(0,i.iD)("div",{class:"item",key:s},[(0,i._)("div",h,[(0,i._)("p",null,[(0,i._)("span",null,(0,a.zw)(t.agriculturalBo.title),1),(0,i._)("span",g,(0,a.zw)(t.agriculturalBo.agriculturalCategory),1)]),(0,i._)("p",null,(0,a.zw)(t.agriculturalBo.manufacturers),1),(0,i._)("p",null," 规格："+(0,a.zw)(t.agriculturalBo.agriculturalCount)+(0,a.zw)(t.agriculturalBo.unitweight)+"/"+(0,a.zw)(t.agriculturalBo.unitmeasurement),1)]),(0,i._)("div",w,[(0,i._)("p",f," 库存："+(0,a.zw)(t.agriculturalUnit)+(0,a.zw)(t.agriculturalBo.unitmeasurement)+" (共"+(0,a.zw)(t.agriculturalCount)+(0,a.zw)(t.agriculturalBo.unitweight)+") ",1),(0,i._)("p",null,[y,(0,i.Wm)(o,{size:"small",style:{width:"70px","margin-right":"10px"},modelValue:t.num,"onUpdate:modelValue":e=>t.num=e},null,8,["modelValue","onUpdate:modelValue"]),(0,i._)("span",null,(0,a.zw)(t.agriculturalBo.unitweight),1)]),0==s?((0,i.wg)(),(0,i.iD)("p",k,[(0,i.Wm)(l,{size:"small",type:"primary",onClick:e.add},{default:(0,i.w5)((()=>[b,_])),_:1},8,["onClick"])])):(0,i.kq)("",!0)])])))),128)),(0,i._)("div",v,[(0,i._)("p",null,[x,V,(0,i.Wm)(Y,{modelValue:e.defaultType,"onUpdate:modelValue":t[0]||(t[0]=t=>e.defaultType=t),class:"m-2",style:{width:"220px"},placeholder:"请选择入库类型"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.typeList,(e=>((0,i.wg)(),(0,i.j4)(j,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,i._)("p",null,[U,W,(0,i.Wm)(O,{modelValue:e.outInTime,"onUpdate:modelValue":t[1]||(t[1]=t=>e.outInTime=t),type:"datetime",placeholder:"请选择时间"},null,8,["modelValue"])]),(0,i.wy)((0,i._)("p",null,[C,D,(0,i.Wm)(Y,{modelValue:e.userName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.userName=t),class:"m-2",style:{width:"220px","margin-left":"14px"},placeholder:"请选择退回人"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.userlist,(e=>((0,i.wg)(),(0,i.j4)(j,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])],512),[[s.F8,e.defaultType==e.backUser]])]),(0,i._)("div",T,[B,(0,i._)("div",L,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.imgs,((t,l)=>((0,i.wg)(),(0,i.iD)("div",{class:"img",key:l},[(0,i._)("img",{src:t,alt:""},null,8,I),(0,i._)("i",{class:"erp erpguanbi",onClick:t=>e.removeImg(l)},null,8,$)])))),128)),e.imgs.length<2?((0,i.wg)(),(0,i.iD)("div",z,[e.uploading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("input",{key:0,onChange:t[3]||(t[3]=(...t)=>e.uploadFile&&e.uploadFile(...t)),ref:"file",type:"file"},null,544)),e.uploading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("p",R,S)),e.uploading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("p",N,"点击上传单据、凭证、照片")),e.uploading?((0,i.wg)(),(0,i.j4)(A,{key:3,width:"90",type:"circle",percentage:e.percentage},null,8,["percentage"])):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])]),(0,i._)("div",K,[P,(0,i.Wm)(o,{modelValue:e.note,"onUpdate:modelValue":t[4]||(t[4]=t=>e.note=t),rows:5,type:"textarea",placeholder:"输入备注内容"},null,8,["modelValue"])]),(0,i._)("div",q,[(0,i.Wm)(l,{type:"primary",onClick:e.submit,loading:e.submitting},{default:(0,i.w5)((()=>[H])),_:1},8,["onClick","loading"])])])),[[Z,e.loading]])]),e.showReg?((0,i.wg)(),(0,i.j4)(F,{key:0,title:"请选择要操作的农资",default:"1",selected:e.selected,onOnSubmit:e.onRegSubmit,onCloseReg:e.closeReg},null,8,["selected","onOnSubmit","onCloseReg"])):(0,i.kq)("",!0)])}var O=l(3483),A=l(9737),F=l(6799),Z={name:"stockPut",data(){return{loading:!1,list:[],defaultType:"",backUser:"",typeList:[],userlist:[],userName:"",num:"",outInTime:new Date,note:"",showReg:!1,uploading:!1,imgs:[],percentage:0,submitting:!1,selected:[]}},components:{StockReg:F.Z},mounted(){let e=this;const t=async function(){e.loading=!0,await e.getDetail(),await e.getPutTypeList(),await e.getUserList(),e.loading=!1};t()},methods:{add(){this.selected=this.list.map((e=>e.agriculturalBo.id)),this.showReg=!0},getDetail(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/agricultural-detail",{id:this.$route.query.id}).then((t=>{t.data.num="",this.list.push(t.data),e()}))}))},getPutTypeList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/getStorageType").then((t=>{this.typeList=t.data,t.data.map((e=>{"已领用退回"==e.title&&(this.backUser=e.id)})),e()}))}))},getUserList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/task/getOrganizationUsers").then((t=>{this.userlist=t.data,e()}))}))},back(){this.$router.push("/erp/stock")},closeReg(){let e=setTimeout((()=>{this.showReg=!1,clearTimeout(e)}),500)},onRegSubmit(e){let t=[];e.map((e=>{let l=!1;this.list.map((t=>{e.id==t.id&&(l=!0)})),l||(e.agriculturalBo=JSON.parse(JSON.stringify(e)),t.push(e))})),this.list=[...this.list,...t]},uploadFile(){this.uploading=!0;let e=this.$refs.file.files[0];(0,O.Z)(e,`erp/materialsInto/${e.name}`).then((e=>{e.url&&(this.imgs.push(e.url),this.uploading=!1,this.percentage=0)}))},removeImg(e){console.log(e),this.imgs.splice(e,1)},submit(){let e=-1,t="",l=this.list.map(((l,i)=>(l.num||-1!=e||(e=i,t=l.agriculturalBo.title),{agriculturalCount:l.num,id:l.id,title:l.agriculturalBo.title})));A.T.confirm(`农资名称：${l.map((e=>e.title)).join("、")} <br> 确定要入库吗？`,"农资入库",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((()=>{if(e>-1)return void this.$message.warning(`请输入 [ ${t} ] 的入库数量`);if(!this.defaultType)return void this.$message.warning("请选择入库类型");if(!this.outInTime)return void this.$message.warning("请选择入库时间");if(this.defaultType==this.backUser&&!this.userName)return void this.$message.warning("请输入退回人");if(this.imgs.length<=0)return void this.$message.warning("请上传凭证");let i="";this.typeList.map((e=>{e.id==this.defaultType&&(i=e.title)}));let a="";this.userName&&this.userlist.map((e=>{e.id==this.userName&&(a=e.name)})),this.submitting=!0,this.ajax.post("/api/v1/adam/farmLand/saveAgriculturalStorage",{agriculturalOutInBos:l,image:this.imgs.join(","),outInTime:this.outInTime,remark:this.note,type:0,workAid:this.userName,username:a,workType:this.defaultType,workTypeName:i}).then((e=>{if(200==e.code){this.$message.success("入库成功！");let e=setTimeout((()=>{this.$router.push("/erp/stock"),clearTimeout(e)}),800)}else this.$message.error("操作失败，请联系管理员！")}))})).catch((()=>{}))}}},M=l(8118);const J=(0,M.Z)(Z,[["render",Y],["__scopeId","data-v-9890ecaa"]]);var Q=J},6799:function(e,t,l){l.d(t,{Z:function(){return V}});var i=l(6252),a=l(9963),s=l(3577);const o=e=>((0,i.dD)("data-v-d7157102"),e=e(),(0,i.Cn)(),e),u={class:"stockReg"},n={class:"stockRegBoxInner"},r={class:"form"},d={class:"formBox"},m={style:{display:"flex",width:"450px"}},p=o((()=>(0,i._)("span",null,"/",-1))),c={class:"submit"},h=(0,i.Uk)("提交"),g={class:"_import"},w={class:"search"},f=(0,i.Uk)("查询"),y={class:"submit"},k=(0,i.Uk)("提交");function b(e,t){const l=(0,i.up)("el-dialog"),o=(0,i.up)("el-input"),b=(0,i.up)("el-form-item"),_=(0,i.up)("el-option"),v=(0,i.up)("el-select"),x=(0,i.up)("el-col"),V=(0,i.up)("el-form"),U=(0,i.up)("el-button"),W=(0,i.up)("el-table-column"),C=(0,i.up)("el-table"),D=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(l,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showDetailBox,"onUpdate:modelValue":t[2]||(t[2]=t=>e.showDetailBox=t),title:"请选择登记方式",width:"400px"},{default:(0,i.w5)((()=>[(0,i._)("div",n,[e.$store.state.power.addMaterialsInfo?((0,i.wg)(),(0,i.iD)("p",{key:0,onClick:t[0]||(t[0]=(...t)=>e.input&&e.input(...t))},"手动输入农资信息")):(0,i.kq)("",!0),e.$store.state.power.selectMaterialsInfo?((0,i.wg)(),(0,i.iD)("p",{key:1,onClick:t[1]||(t[1]=(...t)=>e._import&&e._import(...t))},"选择平台农资信息")):(0,i.kq)("",!0)])])),_:1},8,["before-close","modelValue"]),(0,i.Wm)(l,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showInput,"onUpdate:modelValue":t[10]||(t[10]=t=>e.showInput=t),title:"手动输入农资信息",width:"600px"},{default:(0,i.w5)((()=>[(0,i._)("div",r,[(0,i._)("div",d,[(0,i.Wm)(V,{model:e.form,"label-width":"70px"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{label:"农资名称"},{default:(0,i.w5)((()=>[(0,i.Wm)(o,{modelValue:e.form.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.title=t),placeholder:"请输入农资名称"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(b,{label:"农资类型"},{default:(0,i.w5)((()=>[(0,i._)("div",m,[(0,i.Wm)(v,{onChange:e.selectType,style:{width:"100%"},modelValue:e.defaultType,"onUpdate:modelValue":t[4]||(t[4]=t=>e.defaultType=t),placeholder:"请选择农资类型"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.typeList,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"]),(0,i.wy)((0,i.Wm)(o,{style:{width:"180px","margin-left":"10px"},modelValue:e.form.definition,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.definition=t),placeholder:"请输入农资类型"},null,8,["modelValue"]),[[a.F8,e.definition]])])])),_:1}),(0,i.Wm)(b,{label:"生产厂家"},{default:(0,i.w5)((()=>[(0,i.Wm)(o,{modelValue:e.form.company,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.company=t),placeholder:"请输入生产厂家"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(b,{label:"规格"},{default:(0,i.w5)((()=>[(0,i.Wm)(x,{span:18},{default:(0,i.w5)((()=>[(0,i.Wm)(o,{modelValue:e.form.weightNum,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.weightNum=t),placeholder:"请输入规格",class:"input-with-select"},{append:(0,i.w5)((()=>[(0,i.Wm)(v,{modelValue:e.defaultWeight,"onUpdate:modelValue":t[7]||(t[7]=t=>e.defaultWeight=t),placeholder:"-",style:{width:"75px"}},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.weightList,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(x,{span:2,style:{"text-align":"center"}},{default:(0,i.w5)((()=>[p])),_:1}),(0,i.Wm)(x,{span:4},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{modelValue:e.defaultUnit,"onUpdate:modelValue":t[9]||(t[9]=t=>e.defaultUnit=t),placeholder:"-",style:{width:"75px"}},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.unitList,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])]),(0,i._)("div",c,[(0,i.Wm)(U,{type:"primary",onClick:e.submitA,loading:e.saveing},{default:(0,i.w5)((()=>[h])),_:1},8,["onClick","loading"])])])])),_:1},8,["before-close","modelValue"]),(0,i.Wm)(l,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showImport,"onUpdate:modelValue":t[12]||(t[12]=t=>e.showImport=t),title:e.title||"选择平台农资信息",width:"800px"},{default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i._)("div",w,[(0,i.Wm)(o,{modelValue:e.searchKey,"onUpdate:modelValue":t[11]||(t[11]=t=>e.searchKey=t),style:{width:"360px"},placeholder:"关键字搜索：农资类型、农资名称、厂家名称"},null,8,["modelValue"]),(0,i.Wm)(U,{style:{"margin-left":"10px"},type:"primary",plain:"",onClick:e.getData},{default:(0,i.w5)((()=>[f])),_:1},8,["onClick"])]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(C,{size:"large",data:e.tableData,ref:"table","max-height":"500",style:{width:"100%"}},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{selectable:e.selectable,type:"selection",width:"55"},null,8,["selectable"]),(0,i.Wm)(W,{prop:"title",label:"农资名称"}),(0,i.Wm)(W,{prop:"agriculturalCategory",label:"农资类型",width:"150"}),(0,i.Wm)(W,{prop:"manufacturers",label:"生产厂家"}),(0,i.Wm)(W,{label:"规格",width:"150"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(e.row.agriculturalCount)+(0,s.zw)(e.row.unitweight)+"/"+(0,s.zw)(e.row.unitmeasurement),1)])),_:1})])),_:1},8,["data"])),[[D,e.loading]]),(0,i._)("div",y,[(0,i.Wm)(U,{type:"primary",onClick:e.submitB,loading:e.submitting},{default:(0,i.w5)((()=>[k])),_:1},8,["onClick","loading"])])])])),_:1},8,["before-close","modelValue","title"])])}var _={name:"stockReg",props:["default","needSubmit","title","selected","kc"],data(){return{loading:!1,showDetailBox:!0,showInput:!1,showImport:!1,form:{},defaultType:"",typeList:[],defaultUnit:"",unitList:[],defaultWeight:"",weightList:[],searchKey:"",tableData:[],saveing:!1,submitting:!1,definition:!1}},mounted(){0==this.default&&this.input(),1==this.default&&this._import()},methods:{selectable(e,t){return!this.selected||!this.selected.includes(e.id)},selectType(e){this.typeList.map((t=>{t.id==e&&"自定义"==t.title&&(this.definition=!0)}))},onClose(){this.$emit("closeReg",0),this.showDetailBox=!1,this.showInput=!1,this.showImport=!1},input(){let e=this;e.showDetailBox=!1,e.showInput=!0,e.showImport=!1;const t=async function(){await e.getTypeList(),await e.getUnitList(),await e.getWeightList()};t()},_import(){this.showDetailBox=!1,this.showInput=!1,this.showImport=!0,this.getData()},getData(){this.loading=!0;let e=1==this.kc?"/api/v1/adam/farmLand/agriculturalSearch-list":"/api/v1/adam/agricultural/platform-list";this.ajax.post(e,{pageNum:1,pageSize:100,param:{categoryId:0,inventory:0,keyWord:this.searchKey}}).then((e=>{this.loading=!1,this.tableData=e.data.map((e=>1==this.kc?(e.agriculturalBo=e.agriculturalBo||{},e.agriculturalBo):(e.agriculturalBo=e.agriculturalBo||{},e))),this.selected&&this.$nextTick((()=>{this.tableData.map((e=>{this.selected.includes(e.id)&&this.$refs.table.toggleRowSelection(e,!0)}))}))}))},getTypeList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getAgriculturalCategory").then((t=>{this.typeList=t.data,e()}))}))},getUnitList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getUnitMeasurement").then((t=>{this.unitList=t.data,e()}))}))},getWeightList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getWeightUnit").then((t=>{this.weightList=t.data,e()}))}))},submitA(){let e="",t=null;this.definition?e=this.form.definition:(t=this.defaultType,this.typeList.map((t=>{t.id==this.defaultType&&(e=t.title)})));let l="";this.weightList.map((e=>{e.id==this.defaultWeight&&(l=e.title)}));let i="";this.unitList.map((e=>{e.id==this.defaultUnit&&(i=e.title)}));let a={agriculturalCategory:e,agriculturalCategoryId:t,title:this.form.title,manufacturers:this.form.company,agriculturalCount:this.form.weightNum,unitweight:l,unitweightid:this.defaultWeight,unitmeasurement:i,unitmeasurementid:this.defaultUnit,definition:this.definition?1:0};this.saveing=!0,this.ajax.post("/api/v1/adam/farmLand/saveDefinition",{agriculturalBoList:[a]}).then((e=>{this.saveing=!1,200==e.code&&(this.$message.success("保存成功"),this.$emit("onSave"),this.onClose())}))},submitB(){if("undefined"==typeof this.needSubmit)this.$emit("onSubmit",this.$refs.table.getSelectionRows()),this.onClose();else{let e=this.$refs.table.getSelectionRows().map((e=>e.id));if(0==e.length)return void this.$message.warning("请选择农资");this.submitting=!0,this.ajax.post("/api/v1/adam/farmLand/savePlatform",{id:e}).then((e=>{this.submitting=!1,200==e.code?(this.$message.success("保存成功"),this.$emit("onSave"),this.onClose()):this.$message.warning(e.message)}))}}}},v=l(8118);const x=(0,v.Z)(_,[["render",b],["__scopeId","data-v-d7157102"]]);var V=x}}]);
//# sourceMappingURL=671.b2e0f9bb.js.map